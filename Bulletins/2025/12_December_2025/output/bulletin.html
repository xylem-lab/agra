<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Crop Yield Forecast Estimates – December</title>

<style>
/* ---------- Reset / Base ---------- */
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height:1.6; color:#333; background:#f5f5f5; }
a { color:#2c5530; text-decoration:none; }

/* ---------- Layout Shell ---------- */
.container { max-width:1200px; margin:0 auto; background:#fff; box-shadow:0 0 20px rgba(0,0,0,0.08); }
.header { background:linear-gradient(135deg, #2c5530, #4a7c4e); color:#fff; padding:2rem; text-align:center; }
.header h1 { font-size:2.5rem; font-weight:300; margin-bottom:.25rem; }
.header .subtitle { font-size:1.1rem; opacity:.9; margin-bottom:.75rem; }
.header .organizations { font-size:.9rem; opacity:.85; }

/* Banner ribbon (logos strip) */
.banner { background:#2f5f39; color:#fff; padding:14px 10px 8px; text-align:center; }
.banner .line1 { font-size:.95rem; opacity:.95; }
.banner .line2 { font-size:.95rem; opacity:.9; margin-top:2px; }
.banner .logos { display:flex; gap:16px; justify-content:center; align-items:center; padding:10px 8px 8px; }
.banner .logos img { height:36px; width:auto; object-fit:contain; filter: drop-shadow(0 1px 1px rgba(0,0,0,.15)); }

/* ---------- Nav ---------- */
.nav { background:#1a4a1e; padding:.75rem 0; position:sticky; top:0; z-index:100; }
.nav ul { list-style:none; display:flex; justify-content:center; flex-wrap:wrap; }
.nav li { margin:0 .75rem; }
.nav a { color:#fff; padding:.45rem .75rem; border-radius:4px; }
.nav a:hover, .nav a.active { background:rgba(255,255,255,0.18); }

/* ---------- Sections ---------- */
.content { padding:2rem; }
.section { margin-bottom:3rem; }
.section h2 { color:#2c5530; font-size:2rem; margin-bottom:1rem; border-bottom:3px solid #4a7c4e; padding-bottom:.5rem; }
.section h3 { color:#1a4a1e; font-size:1.5rem; margin:1.5rem 0 1rem; }
.section h4 { color:#2c5530; font-size:1.1rem; margin:1rem 0 .5rem; }

/* ---------- Cards / Highlights ---------- */
.executive-summary { background:#f8f9fa; padding:1.5rem; border-left:5px solid #4a7c4e; margin:1rem 0 2rem; }
.data-highlight { background:#e8f5e8; padding:1rem; border-radius:8px; margin:1rem 0; }

/* ---------- Country Blocks ---------- */
.country-section { border:1px solid #ddd; border-radius:8px; margin:2rem 0; overflow:hidden; }
.country-header { background:linear-gradient(135deg, #4a7c4e, #2c5530); color:#fff; padding:1.25rem 1.5rem; }
.country-header h3 { margin:0; font-size:1.6rem; }
.country-content { padding:1.5rem; }

/* ---------- Tables ---------- */
table { width:100%; border-collapse:collapse; margin:1rem 0; background:#fff; border-radius:8px; overflow:hidden;
        box-shadow:0 2px 10px rgba(0,0,0,0.06); }
th { background:linear-gradient(135deg, #4a7c4e, #2c5530); color:#fff; padding:0.85rem; text-align:left; font-weight:600; }
td { padding:0.75rem 0.9rem; border-bottom:1px solid #eee; }
tr:nth-child(even) { background:#f8f9fa; }
tr:hover { background:#e8f5e8; transition:background .25s; }

/* Condition chips */
.condition-poor { background:#ffebee; color:#c62828; }
.condition-watch { background:#fff8e1; color:#f57c00; }
.condition-favorable { background:#e8f5e9; color:#2e7d32; }
.condition-exceptional { background:#e3f2fd; color:#1565c0; }

/* ---------- Figures ---------- */
.figure-container { text-align:center; margin:1.75rem 0; }
.figure-container img { max-width:100%; height:auto; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.08); }
.figure-caption { font-style:italic; color:#666; margin-top:.75rem; padding:0 1rem; }
.figure-caption h4 { color:#2c5530; font-size:1.05rem; margin-bottom:.35rem; font-style:normal; }
/* ---------- STRICT 2-UP MAP GRID ---------- */
.figure-grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:16px;
  align-items:start;
  margin:1rem 0 1.75rem;
}

.figure-grid img{
  width:100%;
  height:520px;
  object-fit:contain;   /* no cropping */
  background:#fff;
  border-radius:8px;
}

.figure-placeholder{
  width:100%;
  height:420px;
  border:2px dashed #d6e3db;
  border-radius:8px;
  background:#f8fbf9;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#7a8f86;
  font-style:italic;
  font-size:14px;
}

/* ---------- Comparison table (Executive Summary) ---------- */
.exec-table { margin-top:.75rem; }
.exec-table th, .exec-table td { white-space:nowrap; }

/* ---------- Footer ---------- */
.disclaimer { background:#f8f9fa; border:1px solid #ddd; border-radius:8px; padding:1.25rem; font-size:.92rem; color:#666; }

/* ---------- D3 Chart UI (updated) ---------- */
.chart-wrap{
  margin: 10px auto 26px;
  display:flex; flex-direction:column; align-items:center; gap:12px;
  max-width:980px;   /* centers + constrains chart area */
}
.button-row { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:6px 0; }
.pill{
  border:none; padding:12px 20px; border-radius:999px; cursor:pointer;
  font-size:16px; font-weight:600; letter-spacing:.2px; color:#1b4332; background:#e8f0f2;
  box-shadow:0 2px 6px rgba(0,0,0,.08); transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
}
.pill:hover{ transform:translateY(-1px); box-shadow:0 4px 10px rgba(0,0,0,.12); }
.pill.is-active{ background:#c5d6db; /* darker than neutral */
  color:#0e2f24;
  outline:2px solid #1b4332; /* stronger ring */
  box-shadow:inset 0 0 0 2px rgba(27,67,50,.35), 0 4px 10px rgba(0,0,0,.10);
}
.pill.crop.is-active{ background:#b9d1d7; color:#083125; }
.pill.source[data-src="All"]{ background:#e3eaee; color:#22323a; }
.pill.source.usda{ background:#2c7bb6; color:#fff; }
.pill.source.fao{  background:#f4a259; color:#fff; }
.pill.source.umd{  background:#1a9850; color:#fff; }

#d3-prod-chart{ display:block; margin:0 auto; }

.tooltip {
  position:fixed; pointer-events:none; background:#ffffff; color:#263238; border:1px solid #ddd;
  border-radius:10px; padding:10px 12px; font-size:12px; box-shadow:0 8px 20px rgba(0,0,0,.12); opacity:0; transition:opacity .12s;
}

/* Axis look: larger, darker */
.axis text{ fill:#28352b; font-size:14px; }
.axis path, .axis line{ stroke:#9ab19d; stroke-width:1; }
.y-title{ fill:#2c5530; font-weight:700; font-size:14px; }

/* ---- Chips / region selector ---- */
.control-row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; }
.region-input{ padding:10px 12px; border:1px solid #c9d5cf; border-radius:10px; min-width:240px; font-size:14px; }
.chips{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:6px; }
.chip{ background:#edf4ee; color:#134e4a; border:1px solid #cfe3d8; padding:6px 10px; border-radius:999px; font-size:13px; display:flex; align-items:center; gap:6px; }
.chip button{ border:none; background:transparent; cursor:pointer; font-size:14px; color:#0b3d35; line-height:1; }
.small-note{ font-size:12px; color:#6b7f73; text-align:center; margin-top:2px; }

/* ---------- Regional Table Filters + Sorting ---------- */
.filter-row { 
  display:flex; gap:12px; margin:12px 0; flex-wrap:wrap; 
}
.filter-row label { font-weight:600; margin-right:6px; }
.filter-row select { padding:6px 10px; border:1px solid #aaa; border-radius:6px; }

th.sortable { cursor:pointer; position:relative; }
th.sortable:after {
  content:"⇅"; position:absolute; right:8px; font-size:.8rem; opacity:.6;
}
.filter-actions {
  margin-left: auto;
}

.download-btn {
  background: linear-gradient(135deg, #2c5530, #4a7c4e);
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  padding: 8px 16px;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.download-btn:hover {
  background: linear-gradient(135deg, #35643b, #5a8d59);
  transform: translateY(-1px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

/* ---------- Season Labels (Msimu / Vuli / etc.) ---------- */
.season-tag{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  letter-spacing:.2px;
  background:#edf4ee;
  color:#1a4a1e;
  border:1px solid #cfe3d8;
  margin-left:8px;
  vertical-align:middle;
}

.season-note{
  font-size:0.92rem;
  color:#4f5f55;
  margin-top:8px;
}

</style>

<!-- D3 (once) -->
<script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<div class="container">

  <!-- Header -->
  <header class="header">
    <h1>Crop Yield Forecast Estimates</h1>
    <div class="subtitle">December</div>
  </header>

  <!-- Partner banner -->
  <div class="banner">
    <div class="line1">Partnership for Inclusive Agricultural Transformation in Africa (PIATA)</div>
    <div class="line2">The Regional Food Balance Sheet</div>
    <div class="logos">
      <img src="../data/static/AGRA_Banner.png" alt="Partner Logos" style="width:100%; max-width:900px; height:auto; object-fit:contain;">
    </div>
  </div>

  <!-- Nav -->
  <nav class="nav">
    <ul>
      <li><a href="#overview" class="active">Overview</a></li>
      <li><a href="#executive-summary">Executive Summary</a></li>
      
      <li><a href="#tanzania">Tanzania</a></li>
      
      <li><a href="#malawi">Malawi</a></li>
      
      <li><a href="#zambia">Zambia</a></li>
      
      <li><a href="#rwanda">Rwanda</a></li>
      
      <li><a href="#appendix">Appendix</a></li>
    </ul>
  </nav>

  <main class="content">

    <!-- Overview -->
    <section id="overview" class="section">
      <h2>Overview</h2>
      <p>This report summarizes yield, acreage, and total production estimates for <strong>maize, rice, and beans</strong> across focus countries. The data is updated monthly in the RFBS Dashboard via a standard data file. Our model reports on the main growing season for countries with available historical yield data for model training.</p>

      <h3>Data Limitations and Model Caveats</h3>
      <p>The data used in this report has limitations due to gaps in historical records and variations in data collection methods:</p>
      <ul style="margin-left:1.25rem;">
        <li>Historical data accuracy and consistency vary by country</li>
        <li>Our model reflects these data gaps, as it is trained on available information</li>
        <li>We view these limitations as opportunities to improve data sharing and scaling methods with our country partners</li>
      </ul>

      <div class="data-highlight">
        <p><strong>Current Focus:</strong> Data presented this month focuses on maize, rice and bean systems in <strong>Tanzania, Malawi, Zambia, Rwanda</strong>, which are currently in season.</p>
      </div>
      <div class="data-highlight">
  	<p><strong>Note on excluded countries:</strong> Uganda, Kenya, and Northern Tanzania are excluded from this month's report because they are <strong>post-harvest / out of season</strong>. Once harvesting begins, vegetation indices (NDVI/EVI) are not reliable for predicting yield.</p>
               </div>

    </section>

    <!-- Executive Summary -->
    <section id="executive-summary" class="section">
      <h2>Executive Summary</h2>

      <div class="executive-summary">
        <p>Current projections for December 2025 maize, beans and rice production in East Africa show varying forecasts between USDA, FAO and UMD models, as summarized in Table and Figure below. For maize, Tanzania's USDA and FAO estimates are substantially higher, ranging from 7.0 to 8.0 million MT, while UMD projects a notably lower output between 1.1 and 2.44 million MT, reflecting its narrower geographic scope. Malawi's UMD maize estimates (3.77 - 5.49M MT) surpass USDA and FAO figures (3.0 - 3.5M MT), suggesting model sensitivity to localized conditions. Zambia's maize forecasts are more aligned, with UMD ranging 2.35 - 3.18M MT compared to USDA and FAO near 3.3 - 3.4M MT. In Rwanda, UMD maize production (0.49 - 0.91M MT) shows a wider range than USDA and FAO (0.45 - 0.51M MT). Rice production exhibits discrepancies primarily due to geographic and seasonal definitions; Tanzania’s USDA and FAO estimates (3.58 - 3.8M MT) contrast with UMD's zero production, indicating a possible exclusion of key growing areas. Beans are reported only by UMD, with significant production in Rwanda (0.52 - 0.67M MT) and Malawi (0.18 - 0.3M MT), while Tanzania shows no bean production in UMD data. Overall, December forecasts reveal divergent estimates driven by differences in model scope and seasonal coverage, underscoring the need to contextualize production figures regionally.</p>
      </div>

      <!-- All Sources Interactive Chart -->
      <h3>All Sources Interactive Chart</h3>
      <div class="chart-wrap">
        <div id="crop-buttons" class="button-row"></div>
        <div id="source-buttons" class="button-row" style="margin-top:4px;"></div>
        <svg id="d3-prod-chart" width="980" height="480"></svg>
      </div>
      <div id="d3-tooltip" class="tooltip"></div>

      <script>
        // Combined UMD + non-UMD rows injected by Python
        const rows = [{"Country": "Tanzania", "Crop": "Maize", "Source": "USDA", "Area": 4.0, "Yield": 1.75, "MinProd": 7.0, "MaxProd": 7.0}, {"Country": "Tanzania", "Crop": "Maize", "Source": "FAO", "Area": 4.2, "Yield": 1.9, "MinProd": 8.0, "MaxProd": 8.0}, {"Country": "Tanzania", "Crop": "Rice", "Source": "USDA", "Area": 1.1, "Yield": 3.37, "MinProd": 3.8, "MaxProd": 3.8}, {"Country": "Tanzania", "Crop": "Rice", "Source": "FAO", "Area": 1.2, "Yield": 3.0, "MinProd": 3.58, "MaxProd": 3.58}, {"Country": "Malawi", "Crop": "Maize", "Source": "USDA", "Area": 1.8, "Yield": 1.67, "MinProd": 3.0, "MaxProd": 3.0}, {"Country": "Malawi", "Crop": "Maize", "Source": "FAO", "Area": 1.8, "Yield": 1.76, "MinProd": 3.5, "MaxProd": 3.5}, {"Country": "Malawi", "Crop": "Rice", "Source": "FAO", "Area": 0.07, "Yield": 1.6, "MinProd": 0.12, "MaxProd": 0.12}, {"Country": "Zambia", "Crop": "Maize", "Source": "USDA", "Area": 1.4, "Yield": 2.43, "MinProd": 3.4, "MaxProd": 3.4}, {"Country": "Zambia", "Crop": "Maize", "Source": "FAO", "Area": 1.4, "Yield": 2.3, "MinProd": 3.3, "MaxProd": 3.3}, {"Country": "Zambia", "Crop": "Rice", "Source": "FAO", "Area": 0.05, "Yield": 1.3, "MinProd": 0.006, "MaxProd": 0.006}, {"Country": "Rwanda", "Crop": "Maize", "Source": "USDA", "Area": 0.3, "Yield": 1.5, "MinProd": 0.45, "MaxProd": 0.45}, {"Country": "Rwanda", "Crop": "Maize", "Source": "FAO", "Area": 0.32, "Yield": 1.59, "MinProd": 0.51, "MaxProd": 0.51}, {"Country": "Rwanda", "Crop": "Rice", "Source": "FAO", "Area": 0.032, "Yield": 4.1, "MinProd": 0.13, "MaxProd": 0.13}, {"Country": "Malawi", "Crop": "Beans", "Source": "UMD", "Area": 0.37, "Yield": 0.68, "MinProd": 0.18, "MaxProd": 0.3}, {"Country": "Malawi", "Crop": "Maize", "Source": "UMD", "Area": 1.83, "Yield": 2.52, "MinProd": 3.77, "MaxProd": 5.49}, {"Country": "Malawi", "Crop": "Rice", "Source": "UMD", "Area": 0.08, "Yield": 1.33, "MinProd": 0.08, "MaxProd": 0.13}, {"Country": "Rwanda", "Crop": "Beans", "Source": "UMD", "Area": 0.63, "Yield": 0.94, "MinProd": 0.52, "MaxProd": 0.67}, {"Country": "Rwanda", "Crop": "Maize", "Source": "UMD", "Area": 0.31, "Yield": 2.26, "MinProd": 0.49, "MaxProd": 0.91}, {"Country": "Rwanda", "Crop": "Rice", "Source": "UMD", "Area": 0.03, "Yield": 1.56, "MinProd": 0.04, "MaxProd": 0.06}, {"Country": "Tanzania", "Crop": "Beans", "Source": "UMD", "Area": 0.0, "Yield": 0.83, "MinProd": 0.0, "MaxProd": 0.0}, {"Country": "Tanzania", "Crop": "Maize", "Source": "UMD", "Area": 1.13, "Yield": 1.63, "MinProd": 1.1, "MaxProd": 2.44}, {"Country": "Tanzania", "Crop": "Rice", "Source": "UMD", "Area": 0.0, "Yield": 1.33, "MinProd": 0.0, "MaxProd": 0.0}, {"Country": "Zambia", "Crop": "Beans", "Source": "UMD", "Area": 0.11, "Yield": 0.63, "MinProd": 0.06, "MaxProd": 0.08}, {"Country": "Zambia", "Crop": "Maize", "Source": "UMD", "Area": 1.33, "Yield": 2.05, "MinProd": 2.35, "MaxProd": 3.18}, {"Country": "Zambia", "Crop": "Rice", "Source": "UMD", "Area": 0.04, "Yield": 1.02, "MinProd": 0.03, "MaxProd": 0.05}];

        // Colors per source
        const sourceColors = { USDA:"#2c7bb6", FAO:"#f4a259", UMD:"#1a9850" };

        // State
        const crops   = Array.from(new Set(rows.map(d => d.Crop)));
        const sources = ["All", ...Array.from(new Set(rows.map(d => d.Source)))];
        let activeCrop   = crops[0] || "Maize";
        let activeSource = "All";

        // Crop buttons (neutral)
        const cropBtnSel = d3.select("#crop-buttons")
          .selectAll("button")
          .data(crops)
          .join("button")
            .attr("class","pill crop")
            .classed("is-active", d => d === activeCrop)
            .text(d => d)
            .on("click", (_, d) => { activeCrop=d; cropBtnSel.classed("is-active", x=>x===activeCrop); update(); });

        // Source buttons (colored)
        const srcBtnSel = d3.select("#source-buttons")
          .selectAll("button")
          .data(sources)
          .join("button")
            .attr("class", d => "pill source " + (d==="All" ? "" : d.toLowerCase()))
            .attr("data-src", d => d)
            .style("background", d => d==="All" ? "#e3eaee" : (sourceColors[d]||"#888"))
            .style("color", d => d==="All" ? "#22323a" : "#fff")
            .classed("is-active", d => d === activeSource)
            .text(d => d)
            .on("click", (_, d) => { activeSource=d; srcBtnSel.classed("is-active", x=>x===activeSource); update(); });

        // Chart scaffold
        const svg = d3.select("#d3-prod-chart");
        const margin = {top: 16, right: 24, bottom: 64, left: 80};
        const W = +svg.attr("width")  - margin.left - margin.right;
        const H = +svg.attr("height") - margin.top  - margin.bottom;
        const g  = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
        const gx = g.append("g").attr("class","axis").attr("transform", `translate(0,${H})`);
        const gy = g.append("g").attr("class","axis");
        g.append("text").attr("class","y-title")
          .attr("x",-H/2).attr("y",-56).attr("transform","rotate(-90)")
          .attr("text-anchor","middle")
          .text("Production (Million MT)");

        const x = d3.scaleBand().padding(0.36).range([0, W]); // wider cat spacing
        const y = d3.scaleLinear().range([H, 0]);

        const barLayer = g.append("g");
        const errLayer = g.append("g");
        const capLayer = g.append("g");
        const tooltip  = d3.select("#d3-tooltip");

        function update(){
          let data = rows.filter(r => r.Crop === activeCrop);
          if (activeSource !== "All") data = data.filter(r => r.Source === activeSource);

          // Aggregate per Country+Source
          const grouped = d3.rollups(
            data,
            v => ({
              Country: v[0].Country,
              Source : v[0].Source,
              Crop   : v[0].Crop,
              mean   : d3.mean(v, d => (d.MinProd + d.MaxProd)/2),
              min    : d3.mean(v, d => d.MinProd),
              max    : d3.mean(v, d => d.MaxProd),
              area   : d3.sum(v, d => d.Area),
              yld    : d3.mean(v, d => d.Yield)
            }),
            d => d.Country, d => d.Source
          );

          const flat = [];
          grouped.forEach(([country, arr]) => arr.forEach(([src,val]) => flat.push(val)));

          const countries = Array.from(new Set(flat.map(d => d.Country)));
          x.domain(countries);
          y.domain([0, Math.max(1, d3.max(flat, d => d.max) * 1.15 || 0.5)]).nice();

          // Geometry
          const srcsInView = (activeSource === "All")
            ? Array.from(new Set(flat.map(d => d.Source)))
            : [activeSource];

          const bw = x.bandwidth();
          const xSub = d3.scaleBand().domain(srcsInView).range([0, bw]).paddingInner(0.04).paddingOuter(0.22);
          const SINGLE_WIDTH = Math.min(36, Math.max(18, bw * 0.38));

          function barX(d){
            const bx = x(d.Country) ?? 0;
            if (activeSource === "All") return bx + xSub(d.Source);
            return bx + (bw - SINGLE_WIDTH)/2;
          }
          function barW(){ return activeSource === "All" ? xSub.bandwidth() : SINGLE_WIDTH; }

          // Bars
          const key = d => `${d.Country}__${d.Source}`;
          const bars = barLayer.selectAll("rect.bar").data(flat, key);

          bars.exit().transition().duration(250).attr("y", y(0)).attr("height", 0).remove();

          bars.enter().append("rect")
              .attr("class","bar")
              .attr("rx",3).attr("ry",3)
              .attr("x", d => barX(d))
              .attr("y", y(0)).attr("height", 0).attr("width", barW())
              .attr("fill", d => sourceColors[d.Source] || "#888")
              .attr("opacity", activeSource==="All" ? 0.9 : 0.95)
            .merge(bars)
              .transition().duration(450)
              .attr("x", d => barX(d))
              .attr("width", barW())
              .attr("y", d => y(d.mean))
              .attr("height", d => Math.max(0, y(0) - y(d.mean)));

          // Error bars — UMD only, vertical with caps, not touching axis
          const umdOnly = flat.filter(d => d.Source === "UMD" && (d.max - d.min) > 1e-6);

          const errs = errLayer.selectAll("line.err").data(umdOnly, key);
          errs.exit().remove();
          errs.enter().append("line")
              .attr("class","err")
              .attr("stroke","#2c5530").attr("stroke-width",1.6)
            .merge(errs)
              .transition().duration(450)
              .attr("x1", d => barX(d) + barW()/2)
              .attr("x2", d => barX(d) + barW()/2)
              .attr("y1", d => y(d.max))
              .attr("y2", d => y(d.min));

          const capW = d => Math.max(8, barW() * 0.45);
          const capsTop = capLayer.selectAll("line.capTop").data(umdOnly, key);
          capsTop.exit().remove();
          capsTop.enter().append("line")
              .attr("class","capTop")
              .attr("stroke","#2c5530").attr("stroke-width",1.6)
            .merge(capsTop)
              .transition().duration(450)
              .attr("x1", d => barX(d) + (barW() - capW())/2)
              .attr("x2", d => barX(d) + (barW() + capW())/2)
              .attr("y1", d => y(d.max))
              .attr("y2", d => y(d.max));

          const capsBot = capLayer.selectAll("line.capBot").data(umdOnly, key);
          capsBot.exit().remove();
          capsBot.enter().append("line")
              .attr("class","capBot")
              .attr("stroke","#2c5530").attr("stroke-width",1.6)
            .merge(capsBot)
              .transition().duration(450)
              .attr("x1", d => barX(d) + (barW() - capW())/2)
              .attr("x2", d => barX(d) + (barW() + capW())/2)
              .attr("y1", d => y(d.min))
              .attr("y2", d => y(d.min));

          // Tooltip (only show min–max for UMD)
          barLayer.selectAll("rect.bar")
            .on("pointerenter", function (event, d) {
              d3.select(this).attr("opacity", 1);
              tooltip.style("opacity",1).html(`
                <div style="font-weight:700;margin-bottom:4px;">${d.Country}</div>
                <div>Crop: <b>${d.Crop}</b></div>
                <div>Source: <b>${d.Source}</b></div>
                <div>Mean prod: <b>${d.mean.toFixed(2)}</b> M MT</div>
                ${d.Source==='UMD' ? `<div>Min–Max: <b>${d.min.toFixed(2)} – ${d.max.toFixed(2)}</b> M MT</div>` : ``}
                <div>Area: <b>${d.area.toFixed(2)}</b> M ha</div>
                <div>Yield: <b>${d.yld.toFixed(2)}</b> MT/ha</div>
              `);
            })
            .on("pointermove", function (event) {
              const [px, py] = d3.pointer(event, document.body);
              tooltip.style("left", (px+14)+"px").style("top", (py-10)+"px");
            })
            .on("pointerleave", function(){
              d3.select(this).attr("opacity", activeSource==="All" ? 0.9 : 0.95);
              tooltip.style("opacity",0);
            });

          // Axes (styled via CSS .axis rules)
          gx.transition().duration(350).call(d3.axisBottom(x));
          gy.transition().duration(350).call(d3.axisLeft(y).ticks(6));
        }

        update();
      </script>

      <!-- Comparison table (rows pre-rendered by Python) -->
      <h3>All Sources Comparison Table</h3>
      <table class="exec-table">
        <thead>
          <tr>
            <th>Country</th><th>Crop</th><th>Source</th>
            <th>Area (Million ha)</th><th>Yield (MT/ha)</th><th>Min - Max Production (Million MT)</th>
          </tr>
        </thead>
        <tbody>
          
          <tr>
            
              <td rowspan="7"><strong>Tanzania</strong></td>
            
            
              <td rowspan="3"><strong>Maize</strong></td>
            
            <td style="color:#2c7bb6;">
              USDA
            </td>
            <td>4.0</td>
            <td>1.75</td>
            <td>7.0</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>4.2</td>
            <td>1.9</td>
            <td>8.0</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>1.13</td>
            <td>1.63</td>
            <td>1.1 - 2.44</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="3"><strong>Rice</strong></td>
            
            <td style="color:#2c7bb6;">
              USDA
            </td>
            <td>1.1</td>
            <td>3.37</td>
            <td>3.8</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>1.2</td>
            <td>3.0</td>
            <td>3.58</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.0</td>
            <td>1.33</td>
            <td>0.0 - 0.0</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="1"><strong>Beans</strong></td>
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.0</td>
            <td>0.83</td>
            <td>0.0 - 0.0</td>
          </tr>
          
          <tr>
            
              <td rowspan="6"><strong>Malawi</strong></td>
            
            
              <td rowspan="3"><strong>Maize</strong></td>
            
            <td style="color:#2c7bb6;">
              USDA
            </td>
            <td>1.8</td>
            <td>1.67</td>
            <td>3.0</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>1.8</td>
            <td>1.76</td>
            <td>3.5</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>1.83</td>
            <td>2.52</td>
            <td>3.77 - 5.49</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="2"><strong>Rice</strong></td>
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>0.07</td>
            <td>1.6</td>
            <td>0.12</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.08</td>
            <td>1.33</td>
            <td>0.08 - 0.13</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="1"><strong>Beans</strong></td>
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.37</td>
            <td>0.68</td>
            <td>0.18 - 0.3</td>
          </tr>
          
          <tr>
            
              <td rowspan="6"><strong>Zambia</strong></td>
            
            
              <td rowspan="3"><strong>Maize</strong></td>
            
            <td style="color:#2c7bb6;">
              USDA
            </td>
            <td>1.4</td>
            <td>2.43</td>
            <td>3.4</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>1.4</td>
            <td>2.3</td>
            <td>3.3</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>1.33</td>
            <td>2.05</td>
            <td>2.35 - 3.18</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="2"><strong>Rice</strong></td>
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>0.05</td>
            <td>1.3</td>
            <td>0.006</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.04</td>
            <td>1.02</td>
            <td>0.03 - 0.05</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="1"><strong>Beans</strong></td>
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.11</td>
            <td>0.63</td>
            <td>0.06 - 0.08</td>
          </tr>
          
          <tr>
            
              <td rowspan="6"><strong>Rwanda</strong></td>
            
            
              <td rowspan="3"><strong>Maize</strong></td>
            
            <td style="color:#2c7bb6;">
              USDA
            </td>
            <td>0.3</td>
            <td>1.5</td>
            <td>0.45</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>0.32</td>
            <td>1.59</td>
            <td>0.51</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.31</td>
            <td>2.26</td>
            <td>0.49 - 0.91</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="2"><strong>Rice</strong></td>
            
            <td style="color:#f4a259;">
              FAO
            </td>
            <td>0.03</td>
            <td>4.1</td>
            <td>0.13</td>
          </tr>
          
          <tr>
            
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.03</td>
            <td>1.56</td>
            <td>0.04 - 0.06</td>
          </tr>
          
          <tr>
            
            
              <td rowspan="1"><strong>Beans</strong></td>
            
            <td style="color:#1a9850;">
              UMD
            </td>
            <td>0.63</td>
            <td>0.94</td>
            <td>0.52 - 0.67</td>
          </tr>
          
        </tbody>
      </table>
    </section>

    <!-- Country Chapters built by Python (kept as-is) -->
    <section class="section" id="country-summary">
  <section class="section" id="country-summary">
<h2>Regional Overview/Conditions</h2>
<h3>Country Summary</h3>
<ul class="data-highlight" style="list-style:disc;padding-left:22px;">
<li><strong>Tanzania:</strong> In December, bean yields in the Msimu season regions showed stable to improving trends. Specifically, conditions improved in Iringa, Kigoma, Mbeya, Mtwara, Rukwa, and Ruvuma, while remaining stable elsewhere. Predicted yield anomalies were positive across all regions, ranging from 0.052 in Njombe to a high of 0.272 in Arusha (Vuli season). Similarly, maize in Msimu regions generally exhibited stable or improving trends. The highest yields were recorded in Katavi (2.49 MgT/ha) and Rukwa (2.09 MgT/ha), with positive anomalies reaching 0.397 in Ruvuma; trends in Dodoma and Singida remained notably stable. Rice conditions were more mixed; while most regions maintained stable trends with near-zero anomalies, declining trends were observed in Dodoma, Mtwara, Njombe, Singida, and Pwani, though anomalies remained near zero or slightly negative. No alarming conditions were flagged based on predicted anomalies, but the declining trends in rice warrant monitoring.</li>
<li><strong>Malawi:</strong> Crop conditions remained generally stable across Malawi's key crops of beans, maize, and rice. Beans showed stable trends in all regions, with predicted yield anomalies ranging from 0.006 in the Central Region to 0.107 in the Northern Region, indicating no alarming deviations. Maize exhibited improving trends in every region, with positive yield anomalies from 0.342 in the Central to 0.506 in the Northern Region, signaling favorable growing conditions. Rice conditions were stable, characterized by slight negative anomalies in the Southern (-0.006) and Northern (-0.01) Regions, and a small positive anomaly (0.039) in the Central Region; however, no adverse flags were raised. Despite this positive outlook, the Southern Region’s beans recorded the lowest predicted yield at 0.52 Mg/ha compared to higher values in the North and Central, warranting cautious monitoring.</li>
<li><strong>Zambia:</strong> Maize crop conditions were mostly favorable or improving, especially in Central, Luapula, Northern, and North-Western regions. In these areas, predicted yield anomalies ranged from 0.266 to 0.478, supported by stable or improving trends. In contrast, the Southern and Western regions recorded comparatively lower yields and, while trends remained stable, they exhibited less favorable performance overall. Bean conditions remained generally stable across most regions. Positive yield anomalies were noted in the Northern (0.121), Luapula (0.099), and Western (0.167) regions; however, the Southern region showed a declining trend despite maintaining a slight positive anomaly of 0.057. Rice conditions showed mixed signals with stable to declining trends. Yield anomalies were slightly negative or near zero in Central (-0.064), Lusaka (-0.064), and Southern (-0.038) regions, with notable declining trends in Southern and Lusaka. Conversely, the Eastern, North-Western, and Western regions maintained stable trends with minor positive or near-zero anomalies.</li>
<li><strong>Rwanda:</strong> Beans remained stable across all five regions, with positive yield anomalies ranging from 0.076 MgT/ha in Amajyepfo to 0.173 MgT/ha in Umujyi Wa Kigali. Maize exhibited improving trends and high positive yield anomalies (between 0.252 and 0.277 MgT/ha) across all monitored regions, indicating strong crop vigor. Rice, however, displayed declining trends in four out of five regions. Only Amajyepfo recorded a slight positive anomaly of (0.048 MgT/ha), while Umujyi Wa Kigali showed the lowest anomaly at 0.008 MgT/ha. These declining trends in rice necessitate close monitoring.</li>
</ul></section>
<div class="country-section" id="tanzania">
  <div class="country-header">
    <h3>Tanzania</h3>
  </div>
  <div class="country-content">
    <div class="figure-container">
      <img src="../data/calendars/Tanzania.png" alt="Tanzania Agricultural Calendar">
      <div class="figure-caption">
        <h4>Figure: Agricultural Calendar – Tanzania</h4>
        <p>Tanzania is currently within the Msimu unimodal season for the southern and unimodal regions, with planting from November through April and harvests starting in May and continuing through July. Meanwhile, the bimodal northern regions continue their second rainfall window from October to February with harvests in January and February for the Vuli season, indicating active crop development and upcoming harvesting in both regions.</p>
      </div>
    </div>
    <h4>Regional Crop Conditions Summary</h4>
    <p>In December, bean yields in the Msimu season regions showed stable to improving trends. Specifically, conditions improved in Iringa, Kigoma, Mbeya, Mtwara, Rukwa, and Ruvuma, while remaining stable elsewhere. Predicted yield anomalies were positive across all regions, ranging from 0.052 in Njombe to a high of 0.272 in Arusha (Vuli season). Similarly, maize in Msimu regions generally exhibited stable or improving trends. The highest yields were recorded in Katavi (2.49 MgT/ha) and Rukwa (2.09 MgT/ha), with positive anomalies reaching 0.397 in Ruvuma; trends in Dodoma and Singida remained notably stable. Rice conditions were more mixed; while most regions maintained stable trends with near-zero anomalies, declining trends were observed in Dodoma, Mtwara, Njombe, Singida, and Pwani, though anomalies remained near zero or slightly negative. No alarming conditions were flagged based on predicted anomalies, but the declining trends in rice warrant monitoring.</p>
<button class="pill" onclick="location.href='#regional-table-tanzania'">
  View Regional Production Forecast Table
</button>
    <div class="figure-container">
      <img src="tanzania_production_part1.png" alt="Tanzania mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Tanzania (Part 1)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <div class="figure-container">
      <img src="tanzania_production_part2.png" alt="Tanzania mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Tanzania (Part 2)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <div class="figure-container">
      <img src="tanzania_production_part3.png" alt="Tanzania mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Tanzania (Part 3)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <div class="figure-container">
      <img src="tanzania_production_part4.png" alt="Tanzania mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Tanzania (Part 4)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <div class="figure-container">
      <img src="tanzania_production_part5.png" alt="Tanzania mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Tanzania (Part 5)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <h4>Rice Maps — Msimu</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Tanzania_Rice_December_Yield_Msimu.png" alt="Tanzania Rice December — Msimu Yield Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Forecasts — Msimu</h4>
          <p>In December 2025, Tanzania's Msimu rice yield prediction recorded the highest yields in Rukwa (1.68 MgT/ha) and Kigoma (2.01 MgT/ha) regions, with the lowest yield in Singida at 0.88 MgT/ha. The yield gradient ranged from a low of 0.88 MgT/ha in Singida to a high of 2.01 MgT/ha in Kigoma, highlighting significant regional variability.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Tanzania_Rice_December_Yield_Anomaly_Msimu.png" alt="Tanzania Rice December — Msimu Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Anomaly — Msimu</h4>
          <p>In December 2025, the Tanzania Msimu rice season recorded the highest positive yield anomaly in Songwe at 0.07 MgT/ha, while Rukwa and Iringa noted the most significant negative anomalies at -0.04 MgT/ha. Regions like Dodoma and Tabora also recorded above-average yields, contrasting with below-average yields in Singida.</p>
        </div></div>
    </div>
    <h4>Maize Maps — Msimu</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Tanzania_Maize_December_Yield_Msimu.png" alt="Tanzania Maize December — Msimu Yield Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Forecasts — Msimu</h4>
          <p>The December 2025 Tanzania Maize (Msimu season) yield ranged from a high of 2.49 MgT/ha in Kigoma to a low of 0.94 MgT/ha in Mtwara. Most regions recorded yields around or above the average of 1.20 to 1.94 MgT/ha, with Mtwara notably below average.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Tanzania_Maize_December_Yield_Anomaly_Msimu.png" alt="Tanzania Maize December — Msimu Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Anomaly — Msimu</h4>
          <p>In December 2025, Tanzania’s Msimu maize yields showed positive anomalies, notably in Ruvuma (0.40 MgT/ha) and Kigoma/Katavi (0.39 MgT/ha) regions, indicating above-average production levels. Conversely, Dodoma (0.13 MgT/ha) and Mtwara (0.14 MgT/ha) noted the lowest positive anomalies, signaling relatively weaker yield performance.</p>
        </div></div>
    </div>
    <h4>Beans Maps — Msimu</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Tanzania_Beans_December_Yield_Msimu.png" alt="Tanzania Beans December — Msimu Yield Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Forecasts — Msimu</h4>
          <p>In December 2025, bean yields in Tanzania's Msimu season peaked in Iringa (1.02 MgT/ha) and Luku (1.00 MgT/ha), whereas Njombe (0.61 MgT/ha) and Singida (0.65 MgT/ha) recorded the lowest yields, indicating significant regional disparities across the country.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Tanzania_Beans_December_Yield_Anomaly_Msimu.png" alt="Tanzania Beans December — Msimu Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Anomaly — Msimu</h4>
          <p>In December 2025, Kigoma lead Tanzania with the highest positive bean yield anomaly at 0.25 MgT/ha, while Singida showed the largest negative anomaly at 0.05 MgT/ha, indicating below-average yields. The map highlights significant regional variability in bean yields during the Msimu season.</p>
        </div></div>
    </div>
    <h4>Production Narrative</h4>
    <p>Maize leads production by area and volume, with significant cultivated areas—largest in Tabora (291,594 ha), Singida (155,590 ha), and Dodoma (165,794 ha). Predicted maize production ranges widely, with top volumes in Tabora (mean 364,092 tons), Dodoma (mean 229,888 tons), and Rukwa (mean 233,765 tons). Beans have limited area data available; thus, production volumes are not quantified but yield and anomaly trends suggest moderate stability or improvement in most regions. Rice lacks area and production data for the Msimu and Vuli seasons, restricting production quantification, though trends suggest mostly stable conditions with some coastal declines. Trend uncertainties are notable for maize and rice in coastal and island zones, while beans exhibit mostly stable to improving trends.</p>
  </div></div>
<div class="country-section" id="malawi">
  <div class="country-header">
    <h3>Malawi</h3>
  </div>
  <div class="country-content">
    <div class="figure-container">
      <img src="../data/calendars/Malawi.png" alt="Malawi Agricultural Calendar">
      <div class="figure-caption">
        <h4>Figure: Agricultural Calendar – Malawi</h4>
        <p>Malawi is currently in the main planting window for the season spanning November to July, with planting activities ongoing across all regions. The main harvest is anticipated to begin in April and continue through July, marking a critical phase for crop growth and development.</p>
      </div>
    </div>
    <h4>Regional Crop Conditions Summary</h4>
    <p>Crop conditions remained generally stable across Malawi's key crops of beans, maize, and rice. Beans showed stable trends in all regions, with predicted yield anomalies ranging from 0.006 in the Central Region to 0.107 in the Northern Region, indicating no alarming deviations. Maize exhibited improving trends in every region, with positive yield anomalies from 0.342 in the Central to 0.506 in the Northern Region, signaling favorable growing conditions. Rice conditions were stable, characterized by slight negative anomalies in the Southern (-0.006) and Northern (-0.01) Regions, and a small positive anomaly (0.039) in the Central Region; however, no adverse flags were raised. Despite this positive outlook, the Southern Region’s beans recorded the lowest predicted yield at 0.52 Mg/ha compared to higher values in the North and Central, warranting cautious monitoring.</p>
<button class="pill" onclick="location.href='#regional-table-malawi'">
  View Regional Production Forecast Table
</button>
    <div class="figure-container">
      <img src="malawi_production_part1.png" alt="Malawi mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Malawi (Part 1)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <h4>Rice Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Malawi_Rice_December_Yield.png" alt="Malawi Rice December Yield Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Forecasts</h4>
          <p>In December 2025, Malawi's Northern Region recorded the highest rice yield prediction at 1.47 MgT ha⁻¹, while the Southern Region had the lowest at 1.19 MgT ha⁻¹, indicating a yield gradient from north (above average) to south (below average). The Central Region yields were intermediate at 1.33 MgT ha⁻¹.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Malawi_Rice_December_Yield_Anomaly.png" alt="Malawi Rice December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Anomaly</h4>
          <p>In December 2025, Malawi's Central Region noted the highest positive rice yield anomaly at +0.04 MgT/ha, signaling above-average yields, whereas the Northern and Southern Regions both experienced slight negative anomalies of -0.01 MgT/ha, reflecting below-average yields. The Central Region stood out as the top-performing area amidst predominantly negative anomalies observed elsewhere in the country.</p>
        </div></div>
    </div>
    <h4>Maize Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Malawi_Maize_December_Yield.png" alt="Malawi Maize December Yield Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Forecasts</h4>
          <p>In December 2025, Malawi’s Central Region recorded the highest predicted maize yield at 2.61 MgT/ha, while the Southern Region has the lowest yield at 2.42 MgT/ha, indicating a yield difference of 0.19 MgT/ha across the country. The Southern Region displayed a low-yield extreme compared to the greener, higher-yielding Central and Northern Regions.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Malawi_Maize_December_Yield_Anomaly.png" alt="Malawi Maize December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Anomaly</h4>
          <p>In December 2025, Malawi's Northern Region noted the highest positive maize yield anomaly at 0.51 MgT/ha, while the Central Region experienced the lowest anomaly at 0.34 MgT/ha, highlighting considerable regional variation in crop performance. The Southern Region yielded a moderate anomaly of 0.43 MgT/ha.</p>
        </div></div>
    </div>
    <h4>Beans Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Malawi_Beans_December_Yield.png" alt="Malawi Beans December Yield Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Forecasts</h4>
          <p>In December 2025, Malawi's Northern Region was the top performer with a predicted bean yield of 0.86 MgT/ha, while the Southern Region showed the lowest yield at 0.52 MgT/ha, highlighting a clear north-to-south gradient in production. The Central Region recorded an intermediate yield of 0.67 MgT/ha.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Malawi_Beans_December_Yield_Anomaly.png" alt="Malawi Beans December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Anomaly</h4>
          <p>In December 2025, the Northern Region of Malawi recorded the highest positive bean yield anomaly at 0.11 MgT ha⁻¹, while the Central Region displayed the lowest anomaly at 0.01 MgT ha⁻¹, with above-average yields in the north and below-average yields in the central area. The Southern Region had a moderate positive anomaly of 0.03 MgT ha⁻¹.</p>
        </div></div>
    </div>
    <h4>Production Narrative</h4>
    <p>Total production area varies by crop and region with maize commanding the largest cultivated area (901,662 ha) in the Central Region, producing a mean predicted output of approximately 2,351,765 tons, followed by 592,161 ha in the Southern (approx. 1,433,590 tons), and 333,215 ha in the Northern Region (approx. 843,691 tons). Maize is the top-performing crop by production volume. Beans are grown on smaller areas, with the Central Region at 181,339 ha yielding around 120,666 tons, Northern Region 67,015 ha with 57,678 tons, and Southern Region 119,093 ha with 61,408 tons. Rice occupies the smallest area, with 39,510 ha in Central producing 52,479 tons, Northern at 14,601 ha yielding 21,479 tons, and Southern at 25,948 ha producing 30,836 tons. Uncertainty is highest in maize production in the Southern Region, reflected by a relatively large standard error (0.558) and a wide range between minimum and maximum predicted production, suggesting variability in yield outcomes. Beans display the narrowest yield and production variability, indicating more consistent forecast confidence.</p>
  </div></div>
<div class="country-section" id="zambia">
  <div class="country-header">
    <h3>Zambia</h3>
  </div>
  <div class="country-content">
    <div class="figure-container">
      <img src="../data/calendars/Zambia.png" alt="Zambia Agricultural Calendar">
      <div class="figure-caption">
        <h4>Figure: Agricultural Calendar – Zambia</h4>
        <p>Zambia is currently in the early main crop season from November to May. Planting is underway since November, and crop development is progressing with the main harvest expected to start in April and conclude in May.</p>
      </div>
    </div>
    <h4>Regional Crop Conditions Summary</h4>
    <p>Maize crop conditions were mostly favorable or improving, especially in Central, Luapula, Northern, and North-Western regions. In these areas, predicted yield anomalies ranged from 0.266 to 0.478, supported by stable or improving trends. In contrast, the Southern and Western regions recorded comparatively lower yields and, while trends remained stable, they exhibited less favorable performance overall. Bean conditions remained generally stable across most regions. Positive yield anomalies were noted in the Northern (0.121), Luapula (0.099), and Western (0.167) regions; however, the Southern region showed a declining trend despite maintaining a slight positive anomaly of 0.057. Rice conditions showed mixed signals with stable to declining trends. Yield anomalies were slightly negative or near zero in Central (-0.064), Lusaka (-0.064), and Southern (-0.038) regions, with notable declining trends in Southern and Lusaka. Conversely, the Eastern, North-Western, and Western regions maintained stable trends with minor positive or near-zero anomalies.</p>
<button class="pill" onclick="location.href='#regional-table-zambia'">
  View Regional Production Forecast Table
</button>
    <div class="figure-container">
      <img src="zambia_production_part1.png" alt="Zambia mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Zambia (Part 1)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <div class="figure-container">
      <img src="zambia_production_part2.png" alt="Zambia mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Zambia (Part 2)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <h4>Rice Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Zambia_Rice_December_Yield.png" alt="Zambia Rice December Yield Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Forecasts</h4>
          <p>In December 2025, Luapula is achieved the highest rice yield in Zambia at 1.42 MgT/ha, while Lusaka recorded the lowest yield at 0.66 MgT/ha. Yield values varied significantly across regions, ranging from 0.66 to 1.42 MgT/ha.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Zambia_Rice_December_Yield_Anomaly.png" alt="Zambia Rice December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Anomaly</h4>
          <p>In December 2025, Luapula noted the largest negative rice yield anomaly at -0.12 MgT/ha, indicating below-average production, while Eastern showed the highest positive anomaly at 0.02 MgT/ha, suggesting above-average yield. Central and Lusaka regions also displayed notable negative anomalies of -0.06 MgT/ha.</p>
        </div></div>
    </div>
    <h4>Maize Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Zambia_Maize_December_Yield.png" alt="Zambia Maize December Yield Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Forecasts</h4>
          <p>In December 2025, Central province was the top-performing maize region in Zambia with an average yield of 2.69 MgT/ha, while the Western province ranked lowest at 0.96 MgT/ha. Notable maize yield extremes ranged from below 1.0 MgT/ha in Western to nearly 2.7 MgT/ha in Central, highlighting significant regional variability.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Zambia_Maize_December_Yield_Anomaly.png" alt="Zambia Maize December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Anomaly</h4>
          <p>In December 2025, Northern and Luapula regions in Zambia achieved the highest positive maize yield anomalies at 0.48 MgT/ha, while Western noted the lowest performance with a negative anomaly near 0.18 MgT/ha, highlighting a significant contrast in regional yield deviations.</p>
        </div></div>
    </div>
    <h4>Beans Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Zambia_Beans_December_Yield.png" alt="Zambia Beans December Yield Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Forecasts</h4>
          <p>In December 2025, Northern Province in Zambia had the highest beans yield at 0.78 MgT/ha, while Southern Province recorded the lowest yield at 0.46 MgT/ha, indicating significant regional yield variability. The map highlights a clear north-to-south gradient from above-average to below-average yields.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Zambia_Beans_December_Yield_Anomaly.png" alt="Zambia Beans December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Anomaly</h4>
          <p>In December 2025, Western Zambia recored the highest positive bean yield anomaly at 0.17 MgT/ha, highlighting above-average performance, while Eastern Zambia had the lowest yield anomaly at 0.03 MgT/ha, reflecting a notable negative anomaly. The Southern and Eastern regions displayed significant negative anomalies, contrasting with positive anomalies seen in Northern, Central, and Western regions.</p>
        </div></div>
    </div>
    <h4>Production Narrative</h4>
    <p>Maize remains the top-performing crop by production area and tonnage with the largest areas in Eastern (365,683 ha), Central (344,294 ha), and Southern (257,292 ha) regions. The highest mean predicted maize production is in Central (926,668 tons), Eastern (621,268 tons), and Southern (378,013 tons) regions. Beans production area is much smaller, with the largest areas in Eastern (33,990 ha), Central (32,002 ha), and Southern (23,915 ha) regions; mean predicted production is highest in Central (21,866 tons), Eastern (17,720 tons), and Southern (11,056 tons) regions. Rice has the smallest production areas with top regions being Eastern (12,739 ha), Central (11,994 ha), and Southern (8,963 ha) producing mean predicted tons of 12,638, 9,969, and 7,047 respectively. Notable uncertainties exist in Southern beans with a declining trend and in rice, where Lusaka and Southern regions show declining trends, while maize in improving regions like Central and Luapula shows optimism.</p>
  </div></div>
<div class="country-section" id="rwanda">
  <div class="country-header">
    <h3>Rwanda</h3>
  </div>
  <div class="country-content">
    <div class="figure-container">
      <img src="../data/calendars/Rwanda.png" alt="Rwanda Agricultural Calendar">
      <div class="figure-caption">
        <h4>Figure: Agricultural Calendar – Rwanda</h4>
        <p>Rwanda is currently in the short rainy season spanning September to December, with predictions made for December. The harvest for this season is expected to start in January and conclude by February, marking the shift from crop growth to harvesting.</p>
      </div>
    </div>
    <h4>Regional Crop Conditions Summary</h4>
    <p>Beans remained stable across all five regions, with positive yield anomalies ranging from 0.076 MgT/ha in Amajyepfo to 0.173 MgT/ha in Umujyi Wa Kigali. Maize exhibited improving trends and high positive yield anomalies (between 0.252 and 0.277 MgT/ha) across all monitored regions, indicating strong crop vigor. Rice, however, displayed declining trends in four out of five regions. Only Amajyepfo recorded a slight positive anomaly of (0.048 MgT/ha), while Umujyi Wa Kigali showed the lowest anomaly at 0.008 MgT/ha. These declining trends in rice necessitate close monitoring</p>
<button class="pill" onclick="location.href='#regional-table-rwanda'">
  View Regional Production Forecast Table
</button>
    <div class="figure-container">
      <img src="rwanda_production_part1.png" alt="Rwanda mean production with min/max">
      <div class="figure-caption">
        <h4>Figure: Mean Predicted Production with Min/Max – Rwanda (Part 1)</h4>
        <p>Bar chart showing mean predicted production for maize, beans, and rice with min/max ranges.</p>
      </div>
    </div>
    <h4>Rice Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Rwanda_Rice_December_Yield.png" alt="Rwanda Rice December Yield Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Forecasts</h4>
          <p>In December 2025, the Amayepfo region was the top-performing area for rice yield in Rwanda with yields reaching 2.42 MgT/ha, while regions like Amayjaruguru, Iburengerezuba, and Iburasirazuba showed the lowest yields at 1.36 MgT/ha, marking a clear yield contrast across the country.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Rwanda_Rice_December_Yield_Anomaly.png" alt="Rwanda Rice December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Rice Yield Anomaly</h4>
          <p>In December 2025, Rwanda's rice yield showed predominantly above-average anomalies, with Upuguyu wa Kigali underperforming at -0.01 MgT/ha, while regions including Amayjaruguru and Iburengerazuba noted positive anomalies up to +0.05 MgT/ha. The map highlights Upuguyu wa Kigali as an extreme low-performing area amidst widespread positive yield anomalies.</p>
        </div></div>
    </div>
    <h4>Maize Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Rwanda_Maize_December_Yield.png" alt="Rwanda Maize December Yield Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Forecasts</h4>
          <p>In December 2025, the Amajyaruguru region recorded the highest predicted maize yield at 2.45 MgT/ha, well above the national average, while the Amajyepfo region had the lowest yield at 2.14 MgT/ha, indicating a notable yield gradient across Rwanda.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Rwanda_Maize_December_Yield_Anomaly.png" alt="Rwanda Maize December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Maize Yield Anomaly</h4>
          <p>In December 2025, the Amayjaruguru region experienced the lowest maize yield anomaly at -0.25 MgT/ha, while Amayjepfo displayed the highest positive anomaly at +0.28 MgT/ha. The map highlights significant regional contrasts, with negative anomalies concentrated in the north and positive anomalies dominant in the south and east.</p>
        </div></div>
    </div>
    <h4>Beans Maps</h4>
    <div class="figure-grid">
      <div class="figure-container">
        <img src="../data/maps/Rwanda_Beans_December_Yield.png" alt="Rwanda Beans December Yield Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Forecasts</h4>
          <p>In December 2025, the top-performing region for beans yield in Rwanda was Amajyaruguru with a yield of 1.14 MgT/ha, while the lowest yield was predicted in Umujyi Wa Kigali at 0.73 MgT/ha, highlighting a significant productivity gradient across the country.</p>
        </div></div>
      <div class="figure-container">
        <img src="../data/maps/Rwanda_Beans_December_Yield_Anomaly.png" alt="Rwanda Beans December Yield Anomaly Map">
        <div class="figure-caption">
          <h4>Regional Beans Yield Anomaly</h4>
          <p>In December 2025, Ambayepfo had the lowest bean yield anomaly at -0.08 MgT/ha, highlighting a significant negative deviation, while Umujyi wa Kigali recorded the highest positive anomaly of 0.17 MgT/ha. Surrounding regions such as Amayjaruguru, Iburengerazuba, and Iburasi Razuba displayed moderate positive anomalies ranging from 0.09 to 0.12 MgT/ha.</p>
        </div></div>
    </div>
    <h4>Production Narrative</h4>
    <p>Bean production areas range from 13,344 ha in Umujyi Wa Kigali to 259,944 ha in Iburasirazuba, with mean predicted production highest in Iburasirazuba at 250,703 tons, followed by Amajyepfo (141,068 tons) and Iburengerazuba (103,714 tons). Maize is the top-performing crop by yield and production with the highest mean production in Iburasirazuba at 298,497 tons over 132,579 ha, followed by Amajyepfo (191,054 tons, 89,213 ha) and Iburengerazuba (109,471 tons, 49,626 ha), all showing improving trends despite substantial uncertainty reflected in standard errors around 0.519. Rice production is smaller in area but significant in Amajyepfo (9,143 ha, 22,098 tons) and Iburasirazuba (13,588 ha, 18,468 tons) while showing declining trends in most regions except stable in Amajyepfo.</p>
  </div></div>

     
</section>
    <!-- === New: Per-country interactive regional charts (injected into each country section) === -->
    <script>
      // Data from Python: { "Kenya": [...], "Uganda":[...], ... }
      // Each row suggested fields: Country, Region, Crop, Area, PredictedYield, MinProd, MaxProd
      // Where MinProd/MaxProd are in tons. If only mean is available, set both equal.
      const regionDataByCountry = {"Tanzania": [{"Region": "Dodoma", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.78, "Trend": "Stable"}, {"Region": "Iringa", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.01, "Trend": "Improving"}, {"Region": "Katavi", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.79, "Trend": "Stable"}, {"Region": "Kigoma", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.88, "Trend": "Improving"}, {"Region": "Lindi", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.66, "Trend": "Stable"}, {"Region": "Mbeya", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.98, "Trend": "Improving"}, {"Region": "Mtwara", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.96, "Trend": "Improving"}, {"Region": "Njombe", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.61, "Trend": "Stable"}, {"Region": "Rukwa", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.0, "Trend": "Improving"}, {"Region": "Ruvuma", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.95, "Trend": "Improving"}, {"Region": "Singida", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.65, "Trend": "Stable"}, {"Region": "Songwe", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.65, "Trend": "Stable"}, {"Region": "Tabora", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.84, "Trend": "Stable"}, {"Region": "Dodoma", "Crop": "Maize", "MeanProd": 230453.65999999997, "MinProd": 119734.0, "MaxProd": 340042.0, "Area": 165794.0, "Yield": 1.39, "Trend": "Stable"}, {"Region": "Iringa", "Crop": "Maize", "MeanProd": 68291.75, "MinProd": 43692.0, "MaxProd": 93257.0, "Area": 39475.0, "Yield": 1.73, "Trend": "Improving"}, {"Region": "Katavi", "Crop": "Maize", "MeanProd": 158906.82, "MinProd": 116353.0, "MaxProd": 201156.0, "Area": 63818.0, "Yield": 2.49, "Trend": "Improving"}, {"Region": "Kigoma", "Crop": "Maize", "MeanProd": 150691.44, "MinProd": 116196.0, "MaxProd": 184719.0, "Area": 77676.0, "Yield": 1.94, "Trend": "Improving"}, {"Region": "Lindi", "Crop": "Maize", "MeanProd": 21091.2, "MinProd": 3556.0, "MaxProd": 38606.0, "Area": 17576.0, "Yield": 1.2, "Trend": "Stable"}, {"Region": "Mbeya", "Crop": "Maize", "MeanProd": 163067.4, "MinProd": 33810.0, "MaxProd": 292298.0, "Area": 95922.0, "Yield": 1.7, "Trend": "Improving"}, {"Region": "Mtwara", "Crop": "Maize", "MeanProd": 14387.64, "MinProd": 13329.0, "MaxProd": 15557.0, "Area": 15306.0, "Yield": 0.94, "Trend": "Stable"}, {"Region": "Njombe", "Crop": "Maize", "MeanProd": 57098.9, "MinProd": 53641.0, "MaxProd": 60675.0, "Area": 36838.0, "Yield": 1.55, "Trend": "Improving"}, {"Region": "Rukwa", "Crop": "Maize", "MeanProd": 233461.36, "MinProd": 159548.0, "MaxProd": 307981.0, "Area": 111704.0, "Yield": 2.09, "Trend": "Improving"}, {"Region": "Ruvuma", "Crop": "Maize", "MeanProd": 115108.68, "MinProd": 87819.0, "MaxProd": 142254.0, "Area": 57268.0, "Yield": 2.01, "Trend": "Improving"}, {"Region": "Singida", "Crop": "Maize", "MeanProd": 192931.6, "MinProd": 90320.0, "MaxProd": 297068.0, "Area": 155590.0, "Yield": 1.24, "Trend": "Stable"}, {"Region": "Tabora", "Crop": "Maize", "MeanProd": 364492.5, "MinProd": 260687.0, "MaxProd": 467496.0, "Area": 291594.0, "Yield": 1.25, "Trend": "Stable"}, {"Region": "Dodoma", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.03, "Trend": "Declining"}, {"Region": "Iringa", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.34, "Trend": "Stable"}, {"Region": "Katavi", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.6, "Trend": "Stable"}, {"Region": "Kigoma", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 2.01, "Trend": "Improving"}, {"Region": "Lindi", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.22, "Trend": "Stable"}, {"Region": "Mbeya", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.65, "Trend": "Stable"}, {"Region": "Mtwara", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.99, "Trend": "Declining"}, {"Region": "Njombe", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.95, "Trend": "Declining"}, {"Region": "Rukwa", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.68, "Trend": "Stable"}, {"Region": "Ruvuma", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.19, "Trend": "Stable"}, {"Region": "Singida", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.88, "Trend": "Declining"}, {"Region": "Songwe", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.25, "Trend": "Stable"}, {"Region": "Tabora", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.51, "Trend": "Stable"}, {"Region": "Arusha", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.92, "Trend": "Improving"}, {"Region": "Dar Es Salaam", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.05, "Trend": "Improving"}, {"Region": "Geita", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.71, "Trend": "Stable"}, {"Region": "Kagera", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.85, "Trend": "Improving"}, {"Region": "Kaskazini Pemba", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.62, "Trend": "Stable"}, {"Region": "Kaskazini Unguja", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.57, "Trend": "Stable"}, {"Region": "Kilimanjaro", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.99, "Trend": "Improving"}, {"Region": "Kusini Pemba", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.94, "Trend": "Stable"}, {"Region": "Kusini Unguja", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.72, "Trend": "Stable"}, {"Region": "Manyara", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.99, "Trend": "Improving"}, {"Region": "Mara", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.1, "Trend": "Improving"}, {"Region": "Mjini Magharibi", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.72, "Trend": "Stable"}, {"Region": "Morogoro", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.92, "Trend": "Improving"}, {"Region": "Mwanza", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.86, "Trend": "Improving"}, {"Region": "Pwani", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.38, "Trend": "Declining"}, {"Region": "Shinyanga", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.96, "Trend": "Improving"}, {"Region": "Simiyu", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.73, "Trend": "Stable"}, {"Region": "Tanga", "Crop": "Beans", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.08, "Trend": "Improving"}, {"Region": "Arusha", "Crop": "Maize", "MeanProd": 47630.43, "MinProd": 20210.0, "MaxProd": 75263.0, "Area": 31131.0, "Yield": 1.53, "Trend": "Stable"}, {"Region": "Dar Es Salaam", "Crop": "Maize", "MeanProd": 65.28, "MinProd": 65.0, "MaxProd": 68.0, "Area": 64.0, "Yield": 1.02, "Trend": "Stable"}, {"Region": "Geita", "Crop": "Maize", "MeanProd": 199108.97999999998, "MinProd": 168972.0, "MaxProd": 229053.0, "Area": 116438.0, "Yield": 1.71, "Trend": "Stable"}, {"Region": "Kagera", "Crop": "Maize", "MeanProd": 83143.08, "MinProd": 63791.0, "MaxProd": 102439.0, "Area": 48339.0, "Yield": 1.72, "Trend": "Stable"}, {"Region": "Kaskazini Pemba", "Crop": "Maize", "MeanProd": 119.11, "MinProd": 2.0, "MaxProd": 237.0, "Area": 43.0, "Yield": 2.77, "Trend": "Improving"}, {"Region": "Kaskazini Unguja", "Crop": "Maize", "MeanProd": 143.19000000000003, "MinProd": 0.0, "MaxProd": 342.0, "Area": 129.0, "Yield": 1.11, "Trend": "Stable"}, {"Region": "Kilimanjaro", "Crop": "Maize", "MeanProd": 40445.08, "MinProd": 34914.0, "MaxProd": 46109.0, "Area": 23932.0, "Yield": 1.69, "Trend": "Stable"}, {"Region": "Kusini Pemba", "Crop": "Maize", "MeanProd": 21.0, "MinProd": 7.0, "MaxProd": 36.0, "Area": 21.0, "Yield": 1.0, "Trend": "Stable"}, {"Region": "Kusini Unguja", "Crop": "Maize", "MeanProd": 104.32, "MinProd": 75.0, "MaxProd": 136.0, "Area": 64.0, "Yield": 1.63, "Trend": "Improving"}, {"Region": "Manyara", "Crop": "Maize", "MeanProd": 174719.44, "MinProd": 103607.0, "MaxProd": 244706.0, "Area": 114947.0, "Yield": 1.52, "Trend": "Stable"}, {"Region": "Mara", "Crop": "Maize", "MeanProd": 113295.91, "MinProd": 82398.0, "MaxProd": 144157.0, "Area": 67039.0, "Yield": 1.69, "Trend": "Stable"}, {"Region": "Mjini Magharibi", "Crop": "Maize", "MeanProd": 53.97, "MinProd": 52.0, "MaxProd": 60.0, "Area": 21.0, "Yield": 2.57, "Trend": "Improving"}, {"Region": "Morogoro", "Crop": "Maize", "MeanProd": 203940.25, "MinProd": 153472.0, "MaxProd": 254072.0, "Area": 106775.0, "Yield": 1.91, "Trend": "Stable"}, {"Region": "Mwanza", "Crop": "Maize", "MeanProd": 193534.8, "MinProd": 95533.0, "MaxProd": 290853.0, "Area": 113844.0, "Yield": 1.7, "Trend": "Stable"}, {"Region": "Pwani", "Crop": "Maize", "MeanProd": 7794.82, "MinProd": 5245.0, "MaxProd": 10317.0, "Area": 6442.0, "Yield": 1.21, "Trend": "Stable"}, {"Region": "Shinyanga", "Crop": "Maize", "MeanProd": 164300.40000000002, "MinProd": 159241.0, "MaxProd": 169305.0, "Area": 149364.0, "Yield": 1.1, "Trend": "Stable"}, {"Region": "Simiyu", "Crop": "Maize", "MeanProd": 124912.8, "MinProd": 114872.0, "MaxProd": 134979.0, "Area": 138792.0, "Yield": 0.9, "Trend": "Declining"}, {"Region": "Tanga", "Crop": "Maize", "MeanProd": 41189.01, "MinProd": 37735.0, "MaxProd": 44822.0, "Area": 33487.0, "Yield": 1.23, "Trend": "Stable"}, {"Region": "Arusha", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 2.03, "Trend": "Stable"}, {"Region": "Dar Es Salaam", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.14, "Trend": "Stable"}, {"Region": "Geita", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.65, "Trend": "Stable"}, {"Region": "Kagera", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.48, "Trend": "Stable"}, {"Region": "Kaskazini Pemba", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.2, "Trend": "Stable"}, {"Region": "Kaskazini Unguja", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.92, "Trend": "Declining"}, {"Region": "Kilimanjaro", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.41, "Trend": "Stable"}, {"Region": "Kusini Pemba", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.15, "Trend": "Stable"}, {"Region": "Kusini Unguja", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.31, "Trend": "Stable"}, {"Region": "Manyara", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.41, "Trend": "Stable"}, {"Region": "Mara", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.71, "Trend": "Stable"}, {"Region": "Mjini Magharibi", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.51, "Trend": "Stable"}, {"Region": "Morogoro", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.73, "Trend": "Stable"}, {"Region": "Mwanza", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.84, "Trend": "Stable"}, {"Region": "Pwani", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 0.81, "Trend": "Declining"}, {"Region": "Shinyanga", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.38, "Trend": "Stable"}, {"Region": "Simiyu", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.17, "Trend": "Stable"}, {"Region": "Tanga", "Crop": "Rice", "MeanProd": 0.0, "MinProd": 0, "MaxProd": 0, "Area": 0.0, "Yield": 1.22, "Trend": "Stable"}], "Malawi": [{"Region": "Central Region", "Crop": "Beans", "MeanProd": 121497.13, "MinProd": 92917.0, "MaxProd": 148414.0, "Area": 181339.0, "Yield": 0.67, "Trend": "Stable"}, {"Region": "Northern Region", "Crop": "Beans", "MeanProd": 57632.9, "MinProd": 52119.0, "MaxProd": 63238.0, "Area": 67015.0, "Yield": 0.86, "Trend": "Stable"}, {"Region": "Southern Region", "Crop": "Beans", "MeanProd": 61928.36, "MinProd": 37209.0, "MaxProd": 85608.0, "Area": 119093.0, "Yield": 0.52, "Trend": "Stable"}, {"Region": "Central Region", "Crop": "Maize", "MeanProd": 2353337.82, "MinProd": 2077014.0, "MaxProd": 2626516.0, "Area": 901662.0, "Yield": 2.61, "Trend": "Improving"}, {"Region": "Northern Region", "Crop": "Maize", "MeanProd": 843033.95, "MinProd": 684500.0, "MaxProd": 1002882.0, "Area": 333215.0, "Yield": 2.53, "Trend": "Improving"}, {"Region": "Southern Region", "Crop": "Maize", "MeanProd": 1433029.6199999999, "MinProd": 1010939.0, "MaxProd": 1856241.0, "Area": 592161.0, "Yield": 2.42, "Trend": "Improving"}, {"Region": "Central Region", "Crop": "Rice", "MeanProd": 52548.3, "MinProd": 40752.0, "MaxProd": 64206.0, "Area": 39510.0, "Yield": 1.33, "Trend": "Stable"}, {"Region": "Northern Region", "Crop": "Rice", "MeanProd": 21463.47, "MinProd": 19357.0, "MaxProd": 23601.0, "Area": 14601.0, "Yield": 1.47, "Trend": "Stable"}, {"Region": "Southern Region", "Crop": "Rice", "MeanProd": 30878.12, "MinProd": 18085.0, "MaxProd": 43588.0, "Area": 25948.0, "Yield": 1.19, "Trend": "Stable"}], "Zambia": [{"Region": "Central", "Crop": "Beans", "MeanProd": 21761.36, "MinProd": 16943.0, "MaxProd": 26789.0, "Area": 32002.0, "Yield": 0.68, "Trend": "Stable"}, {"Region": "Eastern", "Crop": "Beans", "MeanProd": 17674.8, "MinProd": 14632.0, "MaxProd": 20808.0, "Area": 33990.0, "Yield": 0.52, "Trend": "Stable"}, {"Region": "Luapula", "Crop": "Beans", "MeanProd": 3804.57, "MinProd": 3543.0, "MaxProd": 4047.0, "Area": 6039.0, "Yield": 0.63, "Trend": "Stable"}, {"Region": "Lusaka", "Crop": "Beans", "MeanProd": 2166.6400000000003, "MinProd": 1849.0, "MaxProd": 2511.0, "Area": 3869.0, "Yield": 0.56, "Trend": "Stable"}, {"Region": "North-Western", "Crop": "Beans", "MeanProd": 2914.4500000000003, "MinProd": 2314.0, "MaxProd": 3487.0, "Area": 3785.0, "Yield": 0.77, "Trend": "Stable"}, {"Region": "Northern", "Crop": "Beans", "MeanProd": 7899.06, "MinProd": 6320.0, "MaxProd": 9513.0, "Area": 10127.0, "Yield": 0.78, "Trend": "Stable"}, {"Region": "Southern", "Crop": "Beans", "MeanProd": 11000.9, "MinProd": 9615.0, "MaxProd": 12496.0, "Area": 23915.0, "Yield": 0.46, "Trend": "Declining"}, {"Region": "Western", "Crop": "Beans", "MeanProd": 597.64, "MinProd": 518.0, "MaxProd": 677.0, "Area": 892.0, "Yield": 0.67, "Trend": "Stable"}, {"Region": "Central", "Crop": "Maize", "MeanProd": 926150.86, "MinProd": 901842.0, "MaxProd": 951494.0, "Area": 344294.0, "Yield": 2.69, "Trend": "Improving"}, {"Region": "Copperbelt", "Crop": "Maize", "MeanProd": 212924.8, "MinProd": 170388.0, "MaxProd": 254571.0, "Area": 92576.0, "Yield": 2.3, "Trend": "Stable"}, {"Region": "Eastern", "Crop": "Maize", "MeanProd": 621661.1, "MinProd": 466106.0, "MaxProd": 776429.0, "Area": 365683.0, "Yield": 1.7, "Trend": "Stable"}, {"Region": "Luapula", "Crop": "Maize", "MeanProd": 157239.5, "MinProd": 124584.0, "MaxProd": 190181.0, "Area": 64975.0, "Yield": 2.42, "Trend": "Improving"}, {"Region": "Lusaka", "Crop": "Maize", "MeanProd": 96162.99, "MinProd": 72302.0, "MaxProd": 119728.0, "Area": 41629.0, "Yield": 2.31, "Trend": "Stable"}, {"Region": "North-Western", "Crop": "Maize", "MeanProd": 83885.26000000001, "MinProd": 60814.0, "MaxProd": 106961.0, "Area": 40721.0, "Yield": 2.06, "Trend": "Improving"}, {"Region": "Northern", "Crop": "Maize", "MeanProd": 277845.44999999995, "MinProd": 227446.0, "MaxProd": 328517.0, "Area": 108959.0, "Yield": 2.55, "Trend": "Improving"}, {"Region": "Southern", "Crop": "Maize", "MeanProd": 378219.24, "MinProd": 314291.0, "MaxProd": 441734.0, "Area": 257292.0, "Yield": 1.47, "Trend": "Stable"}, {"Region": "Western", "Crop": "Maize", "MeanProd": 9217.92, "MinProd": 7632.0, "MaxProd": 10739.0, "Area": 9602.0, "Yield": 0.96, "Trend": "Stable"}, {"Region": "Central", "Crop": "Rice", "MeanProd": 9955.019999999999, "MinProd": 9887.0, "MaxProd": 10051.0, "Area": 11994.0, "Yield": 0.83, "Trend": "Declining"}, {"Region": "Eastern", "Crop": "Rice", "MeanProd": 12611.61, "MinProd": 10439.0, "MaxProd": 14837.0, "Area": 12739.0, "Yield": 0.99, "Trend": "Stable"}, {"Region": "Luapula", "Crop": "Rice", "MeanProd": 3213.46, "MinProd": 2014.0, "MaxProd": 4396.0, "Area": 2263.0, "Yield": 1.42, "Trend": "Stable"}, {"Region": "Lusaka", "Crop": "Rice", "MeanProd": 957.0, "MinProd": 228.0, "MaxProd": 1693.0, "Area": 1450.0, "Yield": 0.66, "Trend": "Declining"}, {"Region": "North-Western", "Crop": "Rice", "MeanProd": 1900.1200000000001, "MinProd": 1640.0, "MaxProd": 2155.0, "Area": 1418.0, "Yield": 1.34, "Trend": "Stable"}, {"Region": "Northern", "Crop": "Rice", "MeanProd": 4705.8, "MinProd": 4466.0, "MaxProd": 4943.0, "Area": 3795.0, "Yield": 1.24, "Trend": "Stable"}, {"Region": "Southern", "Crop": "Rice", "MeanProd": 7080.77, "MinProd": 4215.0, "MaxProd": 9879.0, "Area": 8963.0, "Yield": 0.79, "Trend": "Declining"}, {"Region": "Western", "Crop": "Rice", "MeanProd": 287.24, "MinProd": 215.0, "MaxProd": 363.0, "Area": 334.0, "Yield": 0.86, "Trend": "Declining"}], "Rwanda": [{"Region": "Amajyaruguru", "Crop": "Beans", "MeanProd": 90679.01999999999, "MinProd": 81089.0, "MaxProd": 101036.0, "Area": 79543.0, "Yield": 1.14, "Trend": "Stable"}, {"Region": "Amajyepfo", "Crop": "Beans", "MeanProd": 141684.39, "MinProd": 119135.0, "MaxProd": 163000.0, "Area": 174919.0, "Yield": 0.81, "Trend": "Stable"}, {"Region": "Iburasirazuba", "Crop": "Beans", "MeanProd": 249546.24, "MinProd": 218109.0, "MaxProd": 283297.0, "Area": 259944.0, "Yield": 0.96, "Trend": "Stable"}, {"Region": "Iburengerazuba", "Crop": "Beans", "MeanProd": 104111.0, "MinProd": 91514.0, "MaxProd": 115914.0, "Area": 97300.0, "Yield": 1.07, "Trend": "Stable"}, {"Region": "Umujyi Wa Kigali", "Crop": "Beans", "MeanProd": 9741.119999999999, "MinProd": 8088.0, "MaxProd": 11434.0, "Area": 13344.0, "Yield": 0.73, "Trend": "Stable"}, {"Region": "Amajyaruguru", "Crop": "Maize", "MeanProd": 99394.05, "MinProd": 72244.0, "MaxProd": 126153.0, "Area": 40569.0, "Yield": 2.45, "Trend": "Improving"}, {"Region": "Amajyepfo", "Crop": "Maize", "MeanProd": 190915.82, "MinProd": 131780.0, "MaxProd": 250328.0, "Area": 89213.0, "Yield": 2.14, "Trend": "Improving"}, {"Region": "Iburasirazuba", "Crop": "Maize", "MeanProd": 298302.75, "MinProd": 210411.0, "MaxProd": 386583.0, "Area": 132579.0, "Yield": 2.25, "Trend": "Improving"}, {"Region": "Iburengerazuba", "Crop": "Maize", "MeanProd": 109673.45999999999, "MinProd": 76500.0, "MaxProd": 142443.0, "Area": 49626.0, "Yield": 2.21, "Trend": "Improving"}, {"Region": "Amajyaruguru", "Crop": "Rice", "MeanProd": 5653.52, "MinProd": 4337.0, "MaxProd": 6965.0, "Area": 4157.0, "Yield": 1.36, "Trend": "Declining"}, {"Region": "Amajyepfo", "Crop": "Rice", "MeanProd": 22126.059999999998, "MinProd": 19209.0, "MaxProd": 24987.0, "Area": 9143.0, "Yield": 2.42, "Trend": "Stable"}, {"Region": "Iburasirazuba", "Crop": "Rice", "MeanProd": 18479.68, "MinProd": 14175.0, "MaxProd": 22760.0, "Area": 13588.0, "Yield": 1.36, "Trend": "Declining"}, {"Region": "Iburengerazuba", "Crop": "Rice", "MeanProd": 6916.960000000001, "MinProd": 5306.0, "MaxProd": 8520.0, "Area": 5086.0, "Yield": 1.36, "Trend": "Declining"}, {"Region": "Umujyi Wa Kigali", "Crop": "Rice", "MeanProd": 920.0400000000001, "MinProd": 699.0, "MaxProd": 1140.0, "Area": 697.0, "Yield": 1.32, "Trend": "Declining"}]};

      // Utility: slugify for ids / anchors
      const slug = s => String(s || "").toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,'');

      // Hide static PNG production charts inside country sections (true "replace")
      function hideStaticProductionPNGs(sectionEl){
        if (!sectionEl) return;
        const imgs = sectionEl.querySelectorAll('img');
        imgs.forEach(img => {
          const src = (img.getAttribute('src') || '').toLowerCase();
          if (/_production_part\d*\.png$/.test(src) || src.includes('production_part')) {
            const fig = img.closest('.figure-container') || img;
            fig.style.display = 'none';
          }
        });
      }

      // Create and inject a full interactive chart block into a given country section
      function injectRegionChart(country, rows){
        const sec = document.querySelector('.country-section#' + slug(country));
        // fallback: try by heading text if id missing
        let contentHost = sec ? sec.querySelector('.country-content') : null;

        if (!contentHost) {
          // fallback: append to summary section end
          contentHost = document.getElementById('country-summary');
        }

        // Build wrapper
        const wrap = document.createElement('div');
        wrap.className = 'chart-wrap';
        wrap.id = `region-wrap-${slug(country)}`;
        wrap.innerHTML = `
          <h3 style="margin-top:6px;">${country} — Regional Interactive Chart</h3>
          <div class="control-row" style="margin-top:2px;">
            <div id="crop-buttons-${slug(country)}" class="button-row"></div>
          </div>
          <div class="control-row">
            <input id="region-input-${slug(country)}" class="region-input" list="region-list-${slug(country)}" placeholder="Type a region/county and click Add">
            <datalist id="region-list-${slug(country)}"></datalist>
            <button class="pill" id="btn-add-${slug(country)}">Add</button>
            <button class="pill" id="btn-top3-${slug(country)}">Top 3</button>
            <button class="pill" id="btn-top5-${slug(country)}">Top 5</button>
            <button class="pill" id="btn-clear-${slug(country)}">Clear</button>
          </div>
          <div class="chips" id="chips-${slug(country)}"></div>
          <div class="small-note">Bars show mean predicted production; vertical whiskers (UMD) show min–max range.</div>
          <svg id="svg-${slug(country)}" width="980" height="420"></svg>
        `;
        contentHost.appendChild(wrap);

        // Optionally hide old PNGs
        hideStaticProductionPNGs(sec || contentHost);

        // ---- D3 setup for this country ----
        const svg = d3.select(`#svg-${slug(country)}`);
        const margin = {top: 18, right: 22, bottom: 66, left: 92};
        const W = +svg.attr("width")  - margin.left - margin.right;
        const H = +svg.attr("height") - margin.top  - margin.bottom;
        const g  = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
        const gx = g.append("g").attr("class","axis").attr("transform", `translate(0,${H})`);
        const gy = g.append("g").attr("class","axis");
        g.append("text").attr("class","y-title")
          .attr("x",-H/2).attr("y",-70).attr("transform","rotate(-90)")
          .attr("text-anchor","middle").text("Predicted Production (tons)");

        const x = d3.scaleBand().padding(0.36).range([0, W]);
        const y = d3.scaleLinear().range([H, 0]);

        const barLayer = g.append("g");
        const errLayer = g.append("g");
        const capLayer = g.append("g");

        // Data prep
        const allCrops = Array.from(new Set(rows.map(r => String(r.Crop).trim()))).sort();
        let activeCrop = allCrops[0] || "Maize";
        const regionsAll = Array.from(new Set(rows.filter(r => r.Crop===activeCrop).map(r => String(r.Region)))).sort();
        let selectedRegions = [];

        // Build crop buttons
        const cropBtns = d3.select(`#crop-buttons-${slug(country)}`)
          .selectAll("button")
          .data(allCrops)
          .join("button")
          .attr("class","pill crop")
          .classed("is-active", d => d===activeCrop)
          .text(d => d)
          .on("click", (_, d) => {
            activeCrop = d;
            // refresh datalist
            refreshDatalist();
            // reset default selection to Top 5 for new crop
            pickTopN(5);
            cropBtns.classed("is-active", x => x===activeCrop);
            update();
          });

        // Build datalist options
        const datalist = document.getElementById(`region-list-${slug(country)}`);
        function refreshDatalist(){
          datalist.innerHTML = "";
          const regs = Array.from(new Set(rows.filter(r => r.Crop===activeCrop).map(r => String(r.Region)))).sort();
          regs.forEach(r => {
            const opt = document.createElement('option');
            opt.value = r;
            datalist.appendChild(opt);
          });
        }
        refreshDatalist();

        // Helpers to compute mean/min/max per region for active crop
        function regionStatsForCrop(crop){
          const subset = rows.filter(r => r.Crop === crop);
          const byRegion = d3.rollups(
            subset,
            v => {
              // calc mean, min, max production (tons)
              const mins = v.map(d => +d.MinProd).filter(n => Number.isFinite(n));
              const maxs = v.map(d => +d.MaxProd).filter(n => Number.isFinite(n));
              let min = d3.sum(mins);
              let max = d3.sum(maxs);
              if (!Number.isFinite(min) || !Number.isFinite(max)) {
                // fallback to area*yield if min/max missing
                const means = v.map(d => (+d.Area || 0) * (+d.PredictedYield || 0));
                min = max = d3.sum(means);
              }
              const mean = (min + max) / 2;
              return { region: v[0].Region, crop, mean, min, max };
            },
            d => d.Region
          ).map(([region, obj]) => obj);
          // Sort descending mean
          byRegion.sort((a,b) => d3.descending(a.mean, b.mean));
          return byRegion;
        }

        function pickTopN(n){
          const stats = regionStatsForCrop(activeCrop);
          selectedRegions = stats.slice(0, n).map(d => d.region);
          renderChips();
        }

        // Chips UI
        const chipsHost = document.getElementById(`chips-${slug(country)}`);
        function renderChips(){
          chipsHost.innerHTML = "";
          selectedRegions.forEach(reg => {
            const el = document.createElement('span');
            el.className = 'chip';
            el.innerHTML = `${reg} <button aria-label="Remove ${reg}">&times;</button>`;
            el.querySelector('button').addEventListener('click', () => {
              selectedRegions = selectedRegions.filter(x => x !== reg);
              renderChips();
              update();
            });
            chipsHost.appendChild(el);
          });
        }

        // Buttons
        document.getElementById(`btn-add-${slug(country)}`).addEventListener('click', () => {
          const txt = document.getElementById(`region-input-${slug(country)}`).value.trim();
          const validRegions = new Set(rows.filter(r => r.Crop===activeCrop).map(r => String(r.Region)));
          if (txt && validRegions.has(txt) && !selectedRegions.includes(txt)){
            selectedRegions.push(txt);
            renderChips();
            update();
          }
          document.getElementById(`region-input-${slug(country)}`).value = "";
        });
        document.getElementById(`btn-top3-${slug(country)}`).addEventListener('click', () => { pickTopN(3); update(); });
        document.getElementById(`btn-top5-${slug(country)}`).addEventListener('click', () => { pickTopN(5); update(); });
        document.getElementById(`btn-clear-${slug(country)}`).addEventListener('click', () => { selectedRegions = []; renderChips(); update(); });

        // Default: Top 5 for initial crop
        pickTopN(5);

        function update(){
          const stats = regionStatsForCrop(activeCrop);
          const regionSet = new Set(selectedRegions.length ? selectedRegions : stats.slice(0,5).map(d=>d.region));
          const data = stats.filter(d => regionSet.has(d.region));

          // domains
          const regions = data.map(d => d.region);
          x.domain(regions);
          const ymax = d3.max(data, d => d.max) || 1;
          y.domain([0, ymax * 1.15]).nice();

          // bars
          const bars = barLayer.selectAll("rect.bar").data(data, d => d.region);
          bars.exit().transition().duration(250).attr("y", y(0)).attr("height", 0).remove();

          const bw = x.bandwidth();
          const BARW = Math.min(36, Math.max(18, bw * 0.38));

          const cropColors = {
            "Maize": "#1a9850",   // green
            "Rice":  "#f4a259",   // orange
            "Beans": "#5e3c99"    // purple (or any color you like)
          };

          bars.enter().append("rect")
              .attr("class","bar")
              .attr("rx",3).attr("ry",3)
              .attr("x", d => (x(d.region) ?? 0) + (bw - BARW)/2)
              .attr("y", y(0)).attr("height", 0).attr("width", BARW)
              .attr("fill", d => cropColors[d.crop] || "#888")
              .attr("opacity", 0.95)
            .merge(bars)
              .transition().duration(450)
              .attr("x", d => (x(d.region) ?? 0) + (bw - BARW)/2)
              .attr("width", BARW)
              .attr("y", d => y(d.mean))
              .attr("height", d => Math.max(0, y(0) - y(d.mean)))
              .attr("fill", d => cropColors[d.crop] || "#888");

          // error whiskers with caps (UMD)
          const errs = errLayer.selectAll("line.err").data(data, d => d.region);
          errs.exit().remove();
          errs.enter().append("line")
              .attr("class","err")
              .attr("stroke","#2c5530").attr("stroke-width",1.6)
            .merge(errs)
              .transition().duration(450)
              .attr("x1", d => (x(d.region) ?? 0) + (bw)/2)
              .attr("x2", d => (x(d.region) ?? 0) + (bw)/2)
              .attr("y1", d => y(d.max))
              .attr("y2", d => y(d.min));

          const capW = Math.max(8, BARW * 0.4);
          const capsTop = capLayer.selectAll("line.capTop").data(data, d => d.region);
          capsTop.exit().remove();
          capsTop.enter().append("line")
              .attr("class","capTop")
              .attr("stroke","#2c5530").attr("stroke-width",1.6)
            .merge(capsTop)
              .transition().duration(450)
              .attr("x1", d => (x(d.region) ?? 0) + (bw - capW)/2)
              .attr("x2", d => (x(d.region) ?? 0) + (bw + capW)/2)
              .attr("y1", d => y(d.max))
              .attr("y2", d => y(d.max));

          const capsBot = capLayer.selectAll("line.capBot").data(data, d => d.region);
          capsBot.exit().remove();
          capsBot.enter().append("line")
              .attr("class","capBot")
              .attr("stroke","#2c5530").attr("stroke-width",1.6)
            .merge(capsBot)
              .transition().duration(450)
              .attr("x1", d => (x(d.region) ?? 0) + (bw - capW)/2)
              .attr("x2", d => (x(d.region) ?? 0) + (bw + capW)/2)
              .attr("y1", d => y(d.min))
              .attr("y2", d => y(d.min));

          // axes
          gx.transition().duration(350).call(d3.axisBottom(x));
          gy.transition().duration(350).call(d3.axisLeft(y).ticks(6));
        }

        update();
      }

      // Initialize charts for all countries present in data
      document.addEventListener('DOMContentLoaded', () => {
        if (!regionDataByCountry) return;
        Object.keys(regionDataByCountry).forEach(country => {
          try {
            injectRegionChart(country, regionDataByCountry[country] || []);
          } catch (e) {
            console.warn('Failed to inject chart for', country, e);
          }
        });
      });
    </script>
    <!-- === End: per-country interactive charts === -->
    <section id="appendix-tables" class="section">
  <h2>Regional Production Forecast Tables</h2>

  
    <h3 id="regional-table-tanzania">Tanzania – Regional Production Table</h3>

    <div class="filter-row">
      <div>
        <label for="crop-filter-tanzania">Crop:</label>
        <select id="crop-filter-tanzania">
          <option value="All">All</option>
          <option value="Maize">Maize</option>
          <option value="Rice">Rice</option>
          <option value="Beans">Beans</option>
        </select>
      </div>
      <div>
        <label for="cond-filter-tanzania">Condition:</label>
        <select id="cond-filter-tanzania">
          <option value="All">All</option>
          <option value="Exceptional">Exceptional</option>
          <option value="Favorable">Favorable</option>
          <option value="Watch">Watch</option>
          <option value="Poor">Poor</option>
        </select>
      </div>
      <button class="download-btn" data-table="regional-table-tanzania" type="button">
        Download CSV
      </button>
    </div>

    <table class="regional-table" id="regional-table-tanzania">
      <thead>
        <tr>
          <th>Crop</th>
          <th>Region</th>
          <th class="sortable">Predicted Yield (MT/ha)</th>
          <th class="sortable">Yield Anomaly</th>
          <th>Min–Max Production (tons)</th>
          <th>Condition</th>
        </tr>
      </thead>
      <tbody>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Dodoma</td>
          <td>0.78</td>
          <td>0.168</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Iringa</td>
          <td>1.01</td>
          <td>0.2</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Katavi</td>
          <td>0.79</td>
          <td>0.231</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Kigoma</td>
          <td>0.88</td>
          <td>0.252</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Lindi</td>
          <td>0.66</td>
          <td>0.104</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Mbeya</td>
          <td>0.98</td>
          <td>0.191</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Mtwara</td>
          <td>0.96</td>
          <td>0.109</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Njombe</td>
          <td>0.61</td>
          <td>0.052</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Rukwa</td>
          <td>1.0</td>
          <td>0.196</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Ruvuma</td>
          <td>0.95</td>
          <td>0.18</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Singida</td>
          <td>0.65</td>
          <td>0.063</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Songwe</td>
          <td>0.65</td>
          <td>0.088</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Tabora</td>
          <td>0.84</td>
          <td>0.148</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Dodoma</td>
          <td>1.39</td>
          <td>0.131</td>
          <td>119734.0 – 340042.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Iringa</td>
          <td>1.73</td>
          <td>0.32</td>
          <td>43692.0 – 93257.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Katavi</td>
          <td>2.49</td>
          <td>0.388</td>
          <td>116353.0 – 201156.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Kigoma</td>
          <td>1.94</td>
          <td>0.389</td>
          <td>116196.0 – 184719.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Lindi</td>
          <td>1.2</td>
          <td>0.148</td>
          <td>3556.0 – 38606.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Mbeya</td>
          <td>1.7</td>
          <td>0.31</td>
          <td>33810.0 – 292298.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Mtwara</td>
          <td>0.94</td>
          <td>0.125</td>
          <td>13329.0 – 15557.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Njombe</td>
          <td>1.55</td>
          <td>0.252</td>
          <td>53641.0 – 60675.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Rukwa</td>
          <td>2.09</td>
          <td>0.375</td>
          <td>159548.0 – 307981.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Ruvuma</td>
          <td>2.01</td>
          <td>0.397</td>
          <td>87819.0 – 142254.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Singida</td>
          <td>1.24</td>
          <td>0.147</td>
          <td>90320.0 – 297068.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Tabora</td>
          <td>1.25</td>
          <td>0.169</td>
          <td>260687.0 – 467496.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Dodoma</td>
          <td>1.03</td>
          <td>0.058</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Iringa</td>
          <td>1.34</td>
          <td>-0.038</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Katavi</td>
          <td>1.6</td>
          <td>0.003</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Kigoma</td>
          <td>2.01</td>
          <td>0.008</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Lindi</td>
          <td>1.22</td>
          <td>0.048</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Mbeya</td>
          <td>1.65</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Mtwara</td>
          <td>0.99</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Njombe</td>
          <td>0.95</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Rukwa</td>
          <td>1.68</td>
          <td>-0.038</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Ruvuma</td>
          <td>1.19</td>
          <td>0.015</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Singida</td>
          <td>0.88</td>
          <td>-0.011</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Songwe</td>
          <td>1.25</td>
          <td>-0.065</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Tabora</td>
          <td>1.51</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Arusha</td>
          <td>0.92</td>
          <td>0.272</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Dar Es Salaam</td>
          <td>1.05</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Geita</td>
          <td>0.71</td>
          <td>0.149</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Kagera</td>
          <td>0.85</td>
          <td>0.123</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Kaskazini Pemba</td>
          <td>0.62</td>
          <td>0.063</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Kaskazini Unguja</td>
          <td>0.57</td>
          <td>0.007</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Kilimanjaro</td>
          <td>0.99</td>
          <td>0.343</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Kusini Pemba</td>
          <td>0.94</td>
          <td>0.377</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Kusini Unguja</td>
          <td>0.72</td>
          <td>0.161</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Manyara</td>
          <td>0.99</td>
          <td>0.288</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Mara</td>
          <td>1.1</td>
          <td>0.272</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Mjini Magharibi</td>
          <td>0.72</td>
          <td>0.158</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Morogoro</td>
          <td>0.92</td>
          <td>0.17</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Mwanza</td>
          <td>0.86</td>
          <td>0.108</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Pwani</td>
          <td>0.38</td>
          <td>0.153</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Shinyanga</td>
          <td>0.96</td>
          <td>0.18</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Simiyu</td>
          <td>0.73</td>
          <td>0.171</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Tanga</td>
          <td>1.08</td>
          <td>0.215</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Arusha</td>
          <td>1.53</td>
          <td>0.106</td>
          <td>20210.0 – 75263.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Dar Es Salaam</td>
          <td>1.02</td>
          <td>0.005</td>
          <td>65.0 – 68.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Geita</td>
          <td>1.71</td>
          <td>0.309</td>
          <td>168972.0 – 229053.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Kagera</td>
          <td>1.72</td>
          <td>0.325</td>
          <td>63791.0 – 102439.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Kaskazini Pemba</td>
          <td>2.77</td>
          <td>0.1</td>
          <td>2.0 – 237.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Kaskazini Unguja</td>
          <td>1.11</td>
          <td>0.053</td>
          <td>0.0 – 342.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Kilimanjaro</td>
          <td>1.69</td>
          <td>0.162</td>
          <td>34914.0 – 46109.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Watch">
          <td><strong>Maize</strong></td>
          <td>Kusini Pemba</td>
          <td>1.0</td>
          <td>-0.002</td>
          <td>7.0 – 36.0</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Kusini Unguja</td>
          <td>1.63</td>
          <td>0.104</td>
          <td>75.0 – 136.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Manyara</td>
          <td>1.52</td>
          <td>0.054</td>
          <td>103607.0 – 244706.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Mara</td>
          <td>1.69</td>
          <td>0.319</td>
          <td>82398.0 – 144157.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Mjini Magharibi</td>
          <td>2.57</td>
          <td>0.08</td>
          <td>52.0 – 60.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Morogoro</td>
          <td>1.91</td>
          <td>0.109</td>
          <td>153472.0 – 254072.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Mwanza</td>
          <td>1.7</td>
          <td>0.302</td>
          <td>95533.0 – 290853.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Pwani</td>
          <td>1.21</td>
          <td>0.002</td>
          <td>5245.0 – 10317.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Shinyanga</td>
          <td>1.1</td>
          <td>0.118</td>
          <td>159241.0 – 169305.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Simiyu</td>
          <td>0.9</td>
          <td>0.1</td>
          <td>114872.0 – 134979.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Tanga</td>
          <td>1.23</td>
          <td>0.047</td>
          <td>37735.0 – 44822.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Arusha</td>
          <td>2.03</td>
          <td>0.058</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Dar Es Salaam</td>
          <td>1.14</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Geita</td>
          <td>1.65</td>
          <td>0.048</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Kagera</td>
          <td>1.48</td>
          <td>0.048</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Kaskazini Pemba</td>
          <td>1.2</td>
          <td>0.108</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Kaskazini Unguja</td>
          <td>0.92</td>
          <td>-0.033</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Kilimanjaro</td>
          <td>1.41</td>
          <td>-0.042</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Kusini Pemba</td>
          <td>1.15</td>
          <td>0.051</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Poor">
          <td><strong>Rice</strong></td>
          <td>Kusini Unguja</td>
          <td>1.31</td>
          <td>-0.105</td>
          <td>nan – nan</td>
          <td class="condition-poor">Poor</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Manyara</td>
          <td>1.41</td>
          <td>-0.038</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Mara</td>
          <td>1.71</td>
          <td>0.048</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Mjini Magharibi</td>
          <td>1.51</td>
          <td>-0.021</td>
          <td>nan – nan</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Morogoro</td>
          <td>1.73</td>
          <td>0.058</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Mwanza</td>
          <td>1.84</td>
          <td>0.048</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Pwani</td>
          <td>0.81</td>
          <td>0.048</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Shinyanga</td>
          <td>1.38</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Simiyu</td>
          <td>1.17</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Tanga</td>
          <td>1.22</td>
          <td>0.054</td>
          <td>nan – nan</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
      </tbody>
    </table>
  
    <h3 id="regional-table-malawi">Malawi – Regional Production Table</h3>

    <div class="filter-row">
      <div>
        <label for="crop-filter-malawi">Crop:</label>
        <select id="crop-filter-malawi">
          <option value="All">All</option>
          <option value="Maize">Maize</option>
          <option value="Rice">Rice</option>
          <option value="Beans">Beans</option>
        </select>
      </div>
      <div>
        <label for="cond-filter-malawi">Condition:</label>
        <select id="cond-filter-malawi">
          <option value="All">All</option>
          <option value="Exceptional">Exceptional</option>
          <option value="Favorable">Favorable</option>
          <option value="Watch">Watch</option>
          <option value="Poor">Poor</option>
        </select>
      </div>
      <button class="download-btn" data-table="regional-table-malawi" type="button">
        Download CSV
      </button>
    </div>

    <table class="regional-table" id="regional-table-malawi">
      <thead>
        <tr>
          <th>Crop</th>
          <th>Region</th>
          <th class="sortable">Predicted Yield (MT/ha)</th>
          <th class="sortable">Yield Anomaly</th>
          <th>Min–Max Production (tons)</th>
          <th>Condition</th>
        </tr>
      </thead>
      <tbody>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Central Region</td>
          <td>0.67</td>
          <td>0.006</td>
          <td>92917.0 – 148414.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Northern Region</td>
          <td>0.86</td>
          <td>0.107</td>
          <td>52119.0 – 63238.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Southern Region</td>
          <td>0.52</td>
          <td>0.028</td>
          <td>37209.0 – 85608.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Central Region</td>
          <td>2.61</td>
          <td>0.342</td>
          <td>2077014.0 – 2626516.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Northern Region</td>
          <td>2.53</td>
          <td>0.506</td>
          <td>684500.0 – 1002882.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Southern Region</td>
          <td>2.42</td>
          <td>0.428</td>
          <td>1010939.0 – 1856241.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Central Region</td>
          <td>1.33</td>
          <td>0.039</td>
          <td>40752.0 – 64206.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Northern Region</td>
          <td>1.47</td>
          <td>-0.01</td>
          <td>19357.0 – 23601.0</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Southern Region</td>
          <td>1.19</td>
          <td>-0.006</td>
          <td>18085.0 – 43588.0</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
      </tbody>
    </table>
  
    <h3 id="regional-table-zambia">Zambia – Regional Production Table</h3>

    <div class="filter-row">
      <div>
        <label for="crop-filter-zambia">Crop:</label>
        <select id="crop-filter-zambia">
          <option value="All">All</option>
          <option value="Maize">Maize</option>
          <option value="Rice">Rice</option>
          <option value="Beans">Beans</option>
        </select>
      </div>
      <div>
        <label for="cond-filter-zambia">Condition:</label>
        <select id="cond-filter-zambia">
          <option value="All">All</option>
          <option value="Exceptional">Exceptional</option>
          <option value="Favorable">Favorable</option>
          <option value="Watch">Watch</option>
          <option value="Poor">Poor</option>
        </select>
      </div>
      <button class="download-btn" data-table="regional-table-zambia" type="button">
        Download CSV
      </button>
    </div>

    <table class="regional-table" id="regional-table-zambia">
      <thead>
        <tr>
          <th>Crop</th>
          <th>Region</th>
          <th class="sortable">Predicted Yield (MT/ha)</th>
          <th class="sortable">Yield Anomaly</th>
          <th>Min–Max Production (tons)</th>
          <th>Condition</th>
        </tr>
      </thead>
      <tbody>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Central</td>
          <td>0.68</td>
          <td>0.096</td>
          <td>16943.0 – 26789.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Eastern</td>
          <td>0.52</td>
          <td>0.029</td>
          <td>14632.0 – 20808.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Luapula</td>
          <td>0.63</td>
          <td>0.099</td>
          <td>3543.0 – 4047.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Lusaka</td>
          <td>0.56</td>
          <td>0.093</td>
          <td>1849.0 – 2511.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>North-Western</td>
          <td>0.77</td>
          <td>0.068</td>
          <td>2314.0 – 3487.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Northern</td>
          <td>0.78</td>
          <td>0.121</td>
          <td>6320.0 – 9513.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Southern</td>
          <td>0.46</td>
          <td>0.057</td>
          <td>9615.0 – 12496.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Western</td>
          <td>0.67</td>
          <td>0.167</td>
          <td>518.0 – 677.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Central</td>
          <td>2.69</td>
          <td>0.35</td>
          <td>901842.0 – 951494.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Copperbelt</td>
          <td>2.3</td>
          <td>0.282</td>
          <td>170388.0 – 254571.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Eastern</td>
          <td>1.7</td>
          <td>0.266</td>
          <td>466106.0 – 776429.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Luapula</td>
          <td>2.42</td>
          <td>0.478</td>
          <td>124584.0 – 190181.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Lusaka</td>
          <td>2.31</td>
          <td>0.341</td>
          <td>72302.0 – 119728.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>North-Western</td>
          <td>2.06</td>
          <td>0.398</td>
          <td>60814.0 – 106961.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Northern</td>
          <td>2.55</td>
          <td>0.477</td>
          <td>227446.0 – 328517.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Southern</td>
          <td>1.47</td>
          <td>0.28</td>
          <td>314291.0 – 441734.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Western</td>
          <td>0.96</td>
          <td>0.184</td>
          <td>7632.0 – 10739.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Central</td>
          <td>0.83</td>
          <td>-0.064</td>
          <td>9887.0 – 10051.0</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Eastern</td>
          <td>0.99</td>
          <td>0.021</td>
          <td>10439.0 – 14837.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Poor">
          <td><strong>Rice</strong></td>
          <td>Luapula</td>
          <td>1.42</td>
          <td>-0.122</td>
          <td>2014.0 – 4396.0</td>
          <td class="condition-poor">Poor</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Lusaka</td>
          <td>0.66</td>
          <td>-0.064</td>
          <td>228.0 – 1693.0</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>North-Western</td>
          <td>1.34</td>
          <td>0.008</td>
          <td>1640.0 – 2155.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Northern</td>
          <td>1.24</td>
          <td>-0.038</td>
          <td>4466.0 – 4943.0</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Watch">
          <td><strong>Rice</strong></td>
          <td>Southern</td>
          <td>0.79</td>
          <td>-0.038</td>
          <td>4215.0 – 9879.0</td>
          <td class="condition-watch">Watch</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Western</td>
          <td>0.86</td>
          <td>0.008</td>
          <td>215.0 – 363.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
      </tbody>
    </table>
  
    <h3 id="regional-table-rwanda">Rwanda – Regional Production Table</h3>

    <div class="filter-row">
      <div>
        <label for="crop-filter-rwanda">Crop:</label>
        <select id="crop-filter-rwanda">
          <option value="All">All</option>
          <option value="Maize">Maize</option>
          <option value="Rice">Rice</option>
          <option value="Beans">Beans</option>
        </select>
      </div>
      <div>
        <label for="cond-filter-rwanda">Condition:</label>
        <select id="cond-filter-rwanda">
          <option value="All">All</option>
          <option value="Exceptional">Exceptional</option>
          <option value="Favorable">Favorable</option>
          <option value="Watch">Watch</option>
          <option value="Poor">Poor</option>
        </select>
      </div>
      <button class="download-btn" data-table="regional-table-rwanda" type="button">
        Download CSV
      </button>
    </div>

    <table class="regional-table" id="regional-table-rwanda">
      <thead>
        <tr>
          <th>Crop</th>
          <th>Region</th>
          <th class="sortable">Predicted Yield (MT/ha)</th>
          <th class="sortable">Yield Anomaly</th>
          <th>Min–Max Production (tons)</th>
          <th>Condition</th>
        </tr>
      </thead>
      <tbody>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Amajyaruguru</td>
          <td>1.14</td>
          <td>0.117</td>
          <td>81089.0 – 101036.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Amajyepfo</td>
          <td>0.81</td>
          <td>0.076</td>
          <td>119135.0 – 163000.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Iburasirazuba</td>
          <td>0.96</td>
          <td>0.094</td>
          <td>218109.0 – 283297.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Iburengerazuba</td>
          <td>1.07</td>
          <td>0.096</td>
          <td>91514.0 – 115914.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Beans" data-condition="Favorable">
          <td><strong>Beans</strong></td>
          <td>Umujyi Wa Kigali</td>
          <td>0.73</td>
          <td>0.173</td>
          <td>8088.0 – 11434.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Amajyaruguru</td>
          <td>2.45</td>
          <td>0.252</td>
          <td>72244.0 – 126153.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Amajyepfo</td>
          <td>2.14</td>
          <td>0.275</td>
          <td>131780.0 – 250328.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Iburasirazuba</td>
          <td>2.25</td>
          <td>0.277</td>
          <td>210411.0 – 386583.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Maize" data-condition="Favorable">
          <td><strong>Maize</strong></td>
          <td>Iburengerazuba</td>
          <td>2.21</td>
          <td>0.258</td>
          <td>76500.0 – 142443.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Amajyaruguru</td>
          <td>1.36</td>
          <td>0.048</td>
          <td>4337.0 – 6965.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Amajyepfo</td>
          <td>2.42</td>
          <td>0.048</td>
          <td>19209.0 – 24987.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Iburasirazuba</td>
          <td>1.36</td>
          <td>0.048</td>
          <td>14175.0 – 22760.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Iburengerazuba</td>
          <td>1.36</td>
          <td>0.048</td>
          <td>5306.0 – 8520.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
        <tr data-crop="Rice" data-condition="Favorable">
          <td><strong>Rice</strong></td>
          <td>Umujyi Wa Kigali</td>
          <td>1.32</td>
          <td>0.008</td>
          <td>699.0 – 1140.0</td>
          <td class="condition-favorable">Favorable</td>
        </tr>
        
      </tbody>
    </table>
  
</section>

    <!-- Appendix -->
    <section id="appendix" class="section">
      <h2>Appendix A: Model Description and Parameters</h2>

      <h3>Crop Conditions Classes</h3>
      <table>
        <thead><tr><th>Class</th><th>Definition</th></tr></thead>
        <tbody>
          <tr><td class="condition-exceptional"><strong>Exceptional</strong></td><td>Conditions are much better than average at the time of reporting. Used only during the grain-filling through harvest stages.</td></tr>
          <tr><td class="condition-favorable"><strong>Favorable</strong></td><td>Conditions range from slightly below to slightly above-average at reporting time.</td></tr>
          <tr><td class="condition-watch"><strong>Watch</strong></td><td>Near average but with risk to final yields; recovery possible if conditions improve.</td></tr>
          <tr><td class="condition-poor"><strong>Poor</strong></td><td>Well below average; yields likely 10–25% below average with limited recovery potential.</td></tr>
        </tbody>
      </table>

      <h3>Data Sources</h3>
      <table>
        <thead><tr><th>Data Type</th><th>Source</th></tr></thead>
        <tbody>
          <tr><td>NDVI</td><td>UMD GLAM system</td></tr>
          <tr><td>ESI</td><td>NASA SERVIR Global</td></tr>
          <tr><td>Precipitation</td><td>CHIRPS (historical), NOAA CPC</td></tr>
          <tr><td>Precipitation Forecast</td><td>CHIRPS-GEFS</td></tr>
          <tr><td>Soil Moisture</td><td>NASA–USDA Global (SMOS)</td></tr>
          <tr><td>Temperature</td><td>NOAA CPC</td></tr>
        </tbody>
      </table>

      <div class="disclaimer">
        <h4>Disclaimer</h4>
        <p>The opinions expressed in this report are those of the authors and do not necessarily reflect the official policy or position of AGRA, its employees, partners, or affiliates. While every effort has been made to ensure the accuracy and completeness of the information, we assume no responsibility for any errors or omissions.</p>
        <p><strong>Project Lead:</strong> Dr. Catherine Nakalembe<br/>
           <strong>Team:</strong> Xylem Lab / NASA Harvest–Africa Team<br/>
           <strong>Date:</strong> December</p>
      </div>
    </section>

  </main>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Loop through all regional tables
  document.querySelectorAll("table.regional-table").forEach(table => {
    const countryId = table.id.replace("regional-table-", "");
    const cropSel = document.getElementById(`crop-filter-${countryId}`);
    const condSel = document.getElementById(`cond-filter-${countryId}`);
    const downloadBtn = document.querySelector(`.download-btn[data-table="${table.id}"]`);

    // --- FILTERING ---
    function applyFilters() {
      const crop = cropSel.value;
      const cond = condSel.value;
      table.querySelectorAll("tbody tr").forEach(row => {
        const rowCrop = row.getAttribute("data-crop");
        const rowCond = row.getAttribute("data-condition");
        let show = true;
        if (crop !== "All" && rowCrop !== crop) show = false;
        if (cond !== "All" && rowCond !== cond) show = false;
        row.style.display = show ? "" : "none";
      });
    }
    cropSel.addEventListener("change", applyFilters);
    condSel.addEventListener("change", applyFilters);

    // --- SORTING ---
    table.querySelectorAll("th.sortable").forEach((th, idx) => {
      let asc = true;
      th.addEventListener("click", () => {
        const rows = Array.from(table.querySelectorAll("tbody tr")).filter(r => r.style.display !== "none");
        rows.sort((a,b) => {
          const aVal = parseFloat(a.children[idx].innerText) || 0;
          const bVal = parseFloat(b.children[idx].innerText) || 0;
          return asc ? aVal - bVal : bVal - aVal;
        });
        asc = !asc;
        rows.forEach(r => table.querySelector("tbody").appendChild(r));
      });
    });

    // --- DOWNLOAD CSV ---
    if (downloadBtn) {
      downloadBtn.addEventListener("click", (event) => {
        event.stopPropagation(); // prevent double trigger
        event.preventDefault();

        let csv = [];
        const rows = table.querySelectorAll("tr");
        rows.forEach((row, ridx) => {
          if (row.style.display === "none") return; // skip hidden
          const cols = row.querySelectorAll("th,td");
          let values = Array.from(cols).map(c => c.innerText.trim());

          if (ridx === 0) {
            // Header: split Min–Max
            values = values.flatMap(v => {
              if (v.includes("Min–Max")) return ["Min Production (tons)", "Max Production (tons)"];
              return [v];
            });
          } else {
            // Data rows: split ranges
            values = values.flatMap(v => {
              if (v.includes("–")) {
                const parts = v.split("–").map(p => p.trim());
                if (parts.length === 2) return [parts[0], parts[1]];
              }
              return [v];
            });
          }
          csv.push(values.map(v => `"${v}"`).join(","));
        });

        const blob = new Blob([csv.join("\n")], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${countryId}_regional_table.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }); // attach once only
    }
  });
});
</script>

</body>
</html>

```

